<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©˜ë¸ë ˆì˜ˆí”„ ë‹¤ì´ìŠ¤ ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #1a202c;
            --bg-card: #2d3748;
            --bg-board: #0e1218;
            --border-color: #4a5568;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --accent-cyan: #2dd4bf;
            --accent-amber: #fbbF24;
            --group-alkali-metal: #fca5a5;
            --group-alkaline-earth-metal: #fdba74;
            --group-lanthanide: #fde68a;
            --group-actinide: #d9f99d;
            --group-transition-metal: #a5f3fc;
            --group-post-transition-metal: #a7f3d0;
            --group-metalloid: #bfdbfe;
            --group-other-nonmetal: #c7d2fe;
            --group-halogen: #e9d5ff;
            --group-noble-gas: #fbcfe8;
            --group-unknown: #9ca3af;
        }
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
        }
        .periodic-table-grid {
            display: grid;
            grid-template-columns: repeat(18, minmax(0, 1fr));
            gap: 4px;
        }
        .element-cell {
            aspect-ratio: 1 / 1;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 2px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all 0.2s ease-in-out;
            position: relative;
            cursor: default;
            color: #1a202c;
        }
        .element-cell.group-alkali-metal { background-color: var(--group-alkali-metal); }
        .element-cell.group-alkaline-earth-metal { background-color: var(--group-alkaline-earth-metal); }
        .element-cell.group-lanthanide { background-color: var(--group-lanthanide); }
        .element-cell.group-actinide { background-color: var(--group-actinide); }
        .element-cell.group-transition-metal { background-color: var(--group-transition-metal); }
        .element-cell.group-post-transition-metal { background-color: var(--group-post-transition-metal); }
        .element-cell.group-metalloid { background-color: var(--group-metalloid); }
        .element-cell.group-other-nonmetal { background-color: var(--group-other-nonmetal); }
        .element-cell.group-halogen { background-color: var(--group-halogen); }
        .element-cell.group-noble-gas { background-color: var(--group-noble-gas); }
        .element-cell.group-unknown { background-color: var(--group-unknown); }
        
        .element-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        .element-cell.producible {
            outline: 2px solid var(--accent-amber);
            box-shadow: 0 0 10px var(--accent-amber);
        }
        .element-cell.explosion-choice, .element-cell.slide-choice {
            cursor: pointer;
            outline: 2px solid var(--accent-cyan);
            box-shadow: 0 0 10px var(--accent-cyan);
        }
        .element-cell.slide-source {
            cursor: pointer;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 5px var(--accent-amber); }
            50% { box-shadow: 0 0 15px var(--accent-amber); }
        }

        .element-number { font-size: 0.6rem; }
        .element-symbol { font-size: 0.9rem; font-weight: 700; text-align: center; }
        .element-name { font-size: 0.5rem; text-align: center; color: #4a5568; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .cube-container {
            position: absolute;
            bottom: 2px;
            right: 2px;
            display: flex;
            gap: 2px;
        }
        .cube {
            width: 8px;
            height: 8px;
            border-radius: 2px;
            border: 1px solid rgba(0,0,0,0.7);
        }
        .cube-red { background-color: #ef4444; } .cube-blue { background-color: #3b82f6; }
        .cube-green { background-color: #22c55e; } .cube-yellow { background-color: #eab308; }
        .cube-purple { background-color: #a855f7; } .cube-pink { background-color: #ec4899; }

        .player-card.active {
            border-color: var(--accent-amber);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.5);
        }
        
        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            z-index: 40; display: flex; justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: var(--bg-card); border: 1px solid var(--border-color);
            padding: 2rem; border-radius: 0.5rem; max-width: 90vw; max-height: 90vh;
            overflow-y: auto; z-index: 50; color: var(--text-primary);
        }
        .modal-content select {
            color: black;
        }
        .tech-icon {
            display: inline-flex; align-items: center; justify-content: center;
            width: 24px; height: 24px; border-radius: 50%; font-weight: bold;
            color: white; margin-right: 4px;
        }
        .tech-multiply { background-color: #dc2626; } .tech-concat { background-color: #2563eb; }
        .tech-slide { background-color: #16a34a; } .tech-outsource { background-color: #f59e0b; }
        
        .btn {
            padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 700;
            transition: all 0.2s;
            background-image: linear-gradient(to top, rgba(0,0,0,0.2), transparent);
        }
        .btn-primary { background-color: var(--accent-cyan); color: var(--bg-dark); }
        .btn-primary:hover { background-color: #5eead4; }
        .btn-secondary { background-color: var(--border-color); color: var(--text-primary); }
        .btn-secondary:hover { background-color: #718096; }
        .btn:disabled { background-color: #4a5568; color: #718096; cursor: not-allowed; background-image: none; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.875rem; }

        /* Scoreboard Styles */
        #scoreboard-track {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            gap: 2px;
            position: relative;
        }
        .score-cell {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            font-weight: 700;
            padding: 4px 0;
            position: relative;
        }
        .score-cell.dice-reward { color: var(--accent-amber); }
        .score-cell.tech-reward { background-color: #111827; color: white; }
        .score-cell.tech-reward.dice-reward { color: var(--accent-amber); }
        .player-token {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            transition: all 0.5s ease-in-out;
            z-index: 15;
        }
    </style>
</head>
<body class="bg-bg-dark text-text-primary">

    <div id="app" class="container mx-auto p-4 min-h-screen">
        
        <header class="text-center mb-4">
            <h1 class="text-4xl font-bold text-accent-cyan">ğŸ² ë©˜ë¸ë ˆì˜ˆí”„ ë‹¤ì´ìŠ¤</h1>
            <p id="game-status" class="text-lg text-text-secondary mt-2">ê²Œì„ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.</p>
        </header>

        <div id="scoreboard-panel" class="mb-4 p-3 bg-bg-board border border-border-color rounded-lg shadow-lg"></div>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <aside id="players-panel" class="lg:col-span-2 space-y-4"></aside>

            <div id="center-panel" class="lg:col-span-5">
                <div id="periodic-table-container" class="bg-bg-board p-3 rounded-lg shadow-lg"></div>
                <div id="controls-panel" class="mt-4 p-4 bg-bg-card border border-border-color rounded-lg shadow-lg text-center"></div>
                <div id="tech-track-panel" class="mt-4 p-4 bg-bg-card border border-border-color rounded-lg shadow-lg"></div>
            </div>

            <aside id="market-panel" class="lg:col-span-5 grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-xl font-bold text-accent-amber mb-2">ê¸°ë³¸ í™”í•©ë¬¼ ì‹œì¥</h3>
                    <div id="basic-market" class="grid grid-cols-1 gap-3"></div>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-fuchsia-400 mb-2">ê³ ê¸‰ í™”í•©ë¬¼ ì‹œì¥</h3>
                    <div id="advanced-market" class="grid grid-cols-1 gap-3"></div>
                </div>
            </aside>

        </main>
    </div>

    <div id="setup-modal" class="modal-backdrop">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">ê²Œì„ ì„¤ì •</h2>
            <label class="block mb-2 text-text-secondary">í”Œë ˆì´ì–´ ìˆ˜:</label>
            <div id="player-count-selector" class="flex justify-center gap-2 mb-6"></div>
            <button id="start-game-btn" class="w-full btn btn-primary" disabled>ê²Œì„ ì‹œì‘!</button>
        </div>
    </div>

    <div id="calculation-modal" class="modal-backdrop hidden">
        <div class="modal-content w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4">âš›ï¸ ì›ìë²ˆí˜¸ ê³„ì‚°</h2>
            <div id="calc-player-name" class="font-bold mb-2 text-accent-cyan"></div>
            <p class="mb-4 text-text-secondary">êµ´ë¦° ì£¼ì‚¬ìœ„ ëˆˆ:</p>
            <div id="dice-roll-results" class="flex flex-wrap gap-2 mb-4"></div>
            <div class="space-y-4">
                <div>
                    <h3 class="font-bold">ë°©ë²• 1: ì£¼ì‚¬ìœ„ 1ê°œ ì„ íƒ</h3>
                    <div id="single-dice-options" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
                <div>
                    <h3 class="font-bold">ë°©ë²• 2: ì£¼ì‚¬ìœ„ 2ê°œ ì—°ì‚°</h3>
                    <div class="flex items-center gap-2 flex-wrap bg-bg-dark p-3 rounded-md">
                        <select id="calc-dice-1" class="p-2 border border-border-color bg-white rounded"></select>
                        <select id="calc-op" class="p-2 border border-border-color bg-white rounded"></select>
                        <select id="calc-dice-2" class="p-2 border border-border-color bg-white rounded"></select>
                        <span class="font-bold text-lg text-text-secondary">=</span>
                        <span id="calc-result" class="font-bold text-lg w-12 text-center text-accent-amber">?</span>
                    </div>
                    <p id="calc-error" class="text-red-400 text-sm h-5 mt-1"></p>
                </div>
            </div>
            <div class="mt-6 flex justify-between items-center">
                <button id="view-market-calc-btn" class="btn btn-secondary">ì‹œì¥ ë³´ê¸°</button>
                <button id="confirm-production-btn" class="btn btn-primary" disabled>ì´ ì›ì†Œë¡œ ìƒì‚°</button>
            </div>
        </div>
    </div>
    
    <div id="choice-modal" class="modal-backdrop hidden">
        <div class="modal-content text-center">
            <h2 id="choice-title" class="text-xl font-bold mb-4"></h2>
            <div id="choice-options" class="flex flex-wrap justify-center gap-3"></div>
            <div class="mt-6">
                <button id="view-market-choice-btn" class="btn btn-secondary">ì‹œì¥ ë³´ê¸°</button>
            </div>
        </div>
    </div>

    <div id="game-over-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h2 class="text-3xl font-bold mb-4 text-center text-accent-amber">ğŸ† ê²Œì„ ì¢…ë£Œ! ğŸ†</h2>
            <div id="final-scores" class="space-y-2 mb-4"></div>
            <hr class="border-border-color my-4">
            <div id="game-stats" class="text-sm"></div>
            <div class="text-center mt-6">
                <button onclick="location.reload()" class="btn btn-primary">ìƒˆ ê²Œì„ ì‹œì‘</button>
            </div>
        </div>
    </div>
    
    <button id="toggle-dev-panel" class="fixed bottom-2 left-2 text-2xl bg-bg-card p-2 rounded-full shadow-lg z-30">ğŸ› ï¸</button>
    <div id="dev-panel" class="fixed bottom-14 left-2 bg-gray-900 p-3 border border-border-color rounded-lg text-xs space-y-2 z-30 hidden">
        <h4 class="font-bold text-center">ê°œë°œì ë„êµ¬</h4>
        <div class="flex gap-1">
            <input type="number" id="dev-score-num" class="w-16 bg-bg-dark border border-border-color rounded p-1" placeholder="ì ìˆ˜" value="5">
            <button id="dev-add-score" class="btn btn-secondary btn-sm flex-grow">ì ìˆ˜+</button>
        </div>
        <button id="dev-add-die" class="btn btn-secondary btn-sm w-full">ì£¼ì‚¬ìœ„+</button>
        <button id="dev-add-tech" class="btn btn-secondary btn-sm w-full">ê¸°ìˆ +</button>
        <div class="flex gap-1">
            <input type="number" id="dev-element-num" class="w-16 bg-bg-dark border border-border-color rounded p-1" placeholder="ì›ìë²ˆí˜¸">
            <button id="dev-add-cube" class="btn btn-secondary btn-sm flex-grow">íë¸Œ+</button>
        </div>
    </div>

    <button id="return-to-modal-btn" class="fixed bottom-4 left-1/2 -translate-x-1/2 btn btn-primary z-40 hidden">íŒì—…ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

<script>
// DATA
const periodicTableData = [null,{number:1,symbol:"H",name:"ìˆ˜ì†Œ",group:"other-nonmetal"},{number:2,symbol:"He",name:"í—¬ë¥¨",group:"noble-gas"},{number:3,symbol:"Li",name:"ë¦¬íŠ¬",group:"alkali-metal"},{number:4,symbol:"Be",name:"ë² ë¦´ë¥¨",group:"alkaline-earth-metal"},{number:5,symbol:"B",name:"ë¶•ì†Œ",group:"metalloid"},{number:6,symbol:"C",name:"íƒ„ì†Œ",group:"other-nonmetal"},{number:7,symbol:"N",name:"ì§ˆì†Œ",group:"other-nonmetal"},{number:8,symbol:"O",name:"ì‚°ì†Œ",group:"other-nonmetal"},{number:9,symbol:"F",name:"í”Œë£¨ì˜¤ë¦°",group:"halogen"},{number:10,symbol:"Ne",name:"ë„¤ì˜¨",group:"noble-gas"},{number:11,symbol:"Na",name:"ë‚˜íŠ¸ë¥¨",group:"alkali-metal"},{number:12,symbol:"Mg",name:"ë§ˆê·¸ë„¤ìŠ˜",group:"alkaline-earth-metal"},{number:13,symbol:"Al",name:"ì•Œë£¨ë¯¸ëŠ„",group:"post-transition-metal"},{number:14,symbol:"Si",name:"ê·œì†Œ",group:"metalloid"},{number:15,symbol:"P",name:"ì¸",group:"other-nonmetal"},{number:16,symbol:"S",name:"í™©",group:"other-nonmetal"},{number:17,symbol:"Cl",name:"ì—¼ì†Œ",group:"halogen"},{number:18,symbol:"Ar",name:"ì•„ë¥´ê³¤",group:"noble-gas"},{number:19,symbol:"K",name:"ì¹¼ë¥¨",group:"alkali-metal"},{number:20,symbol:"Ca",name:"ì¹¼ìŠ˜",group:"alkaline-earth-metal"},{number:21,symbol:"Sc",name:"ìŠ¤ì¹¸ë“",group:"transition-metal"},{number:22,symbol:"Ti",name:"í‹°íƒ€ëŠ„",group:"transition-metal"},{number:23,symbol:"V",name:"ë°”ë‚˜ë“",group:"transition-metal"},{number:24,symbol:"Cr",name:"í¬ë¡œë®´",group:"transition-metal"},{number:25,symbol:"Mn",name:"ë§ê°€ë‹ˆì¦ˆ",group:"transition-metal"},{number:26,symbol:"Fe",name:"ì² ",group:"transition-metal"},{number:27,symbol:"Co",name:"ì½”ë°œíŠ¸",group:"transition-metal"},{number:28,symbol:"Ni",name:"ë‹ˆì¼ˆ",group:"transition-metal"},{number:29,symbol:"Cu",name:"êµ¬ë¦¬",group:"transition-metal"},{number:30,symbol:"Zn",name:"ì•„ì—°",group:"transition-metal"},{number:31,symbol:"Ga",name:"ê°ˆë¥¨",group:"post-transition-metal"},{number:32,symbol:"Ge",name:"ì €ë§ˆëŠ„",group:"metalloid"},{number:33,symbol:"As",name:"ë¹„ì†Œ",group:"metalloid"},{number:34,symbol:"Se",name:"ì…€ë ˆëŠ„",group:"other-nonmetal"},{number:35,symbol:"Br",name:"ë¸Œë¡œë¯¼",group:"halogen"},{number:36,symbol:"Kr",name:"í¬ë¦½í†¤",group:"noble-gas"},{number:37,symbol:"Rb",name:"ë£¨ë¹„ë“",group:"alkali-metal"},{number:38,symbol:"Sr",name:"ìŠ¤íŠ¸ë¡ íŠ¬",group:"alkaline-earth-metal"},{number:39,symbol:"Y",name:"ì´íŠ¸ë¥¨",group:"transition-metal"},{number:40,symbol:"Zr",name:"ì§€ë¥´ì½”ëŠ„",group:"transition-metal"},{number:41,symbol:"Nb",name:"ë‚˜ì´ì˜¤ë¸€",group:"transition-metal"},{number:42,symbol:"Mo",name:"ëª°ë¦¬ë¸Œë°ë„˜",group:"transition-metal"},{number:43,symbol:"Tc",name:"í…Œí¬ë„¤íŠ¬",group:"transition-metal"},{number:44,symbol:"Ru",name:"ë£¨í…ŒëŠ„",group:"transition-metal"},{number:45,symbol:"Rh",name:"ë¡œë“",group:"transition-metal"},{number:46,symbol:"Pd",name:"íŒ”ë¼ë“",group:"transition-metal"},{number:47,symbol:"Ag",name:"ì€",group:"transition-metal"},{number:48,symbol:"Cd",name:"ì¹´ë“œë®´",group:"transition-metal"},{number:49,symbol:"In",name:"ì¸ë“",group:"post-transition-metal"},{number:50,symbol:"Sn",name:"ì£¼ì„",group:"post-transition-metal"},{number:51,symbol:"Sb",name:"ì•ˆí‹°ëª¨ë‹ˆ",group:"metalloid"},{number:52,symbol:"Te",name:"í…”ë£¨ë¥¨",group:"metalloid"},{number:53,symbol:"I",name:"ì•„ì´ì˜¤ë”˜",group:"halogen"},{number:54,symbol:"Xe",name:"ì œë…¼",group:"noble-gas"},{number:55,symbol:"Cs",name:"ì„¸ìŠ˜",group:"alkali-metal"},{number:56,symbol:"Ba",name:"ë°”ë¥¨",group:"alkaline-earth-metal"},{number:57,symbol:"La",name:"ë€íƒ€ë„˜",group:"lanthanide"},{number:58,symbol:"Ce",name:"ì„¸ë¥¨",group:"lanthanide"},{number:59,symbol:"Pr",name:"í”„ë¼ì„¸ì˜¤ë””ë®´",group:"lanthanide"},{number:60,symbol:"Nd",name:"ë„¤ì˜¤ë””ë®´",group:"lanthanide"},{number:61,symbol:"Pm",name:"í”„ë¡œë©”íŠ¬",group:"lanthanide"},{number:62,symbol:"Sm",name:"ì‚¬ë§ˆë¥¨",group:"lanthanide"},{number:63,symbol:"Eu",name:"ìœ ë¡œí“¸",group:"lanthanide"},{number:64,symbol:"Gd",name:"ê°€ëŒë¦¬ëŠ„",group:"lanthanide"},{number:65,symbol:"Tb",name:"í„°ë¸€",group:"lanthanide"},{number:66,symbol:"Dy",name:"ë””ìŠ¤í”„ë¡œìŠ˜",group:"lanthanide"},{number:67,symbol:"Ho",name:"í™€ë®´",group:"lanthanide"},{number:68,symbol:"Er",name:"ì–´ë¸€",group:"lanthanide"},{number:69,symbol:"Tm",name:"íˆ´ë¥¨",group:"lanthanide"},{number:70,symbol:"Yb",name:"ì´í„°ë¸€",group:"lanthanide"},{number:71,symbol:"Lu",name:"ë£¨í…ŒíŠ¬",group:"lanthanide"},{number:72,symbol:"Hf",name:"í•˜í”„ëŠ„",group:"transition-metal"},{number:73,symbol:"Ta",name:"íƒ„íƒˆëŸ¼",group:"transition-metal"},{number:74,symbol:"W",name:"í……ìŠ¤í…",group:"transition-metal"},{number:75,symbol:"Re",name:"ë ˆëŠ„",group:"transition-metal"},{number:76,symbol:"Os",name:"ì˜¤ìŠ¤ë®´",group:"transition-metal"},{number:77,symbol:"Ir",name:"ì´ë¦¬ë“",group:"transition-metal"},{number:78,symbol:"Pt",name:"ë°±ê¸ˆ",group:"transition-metal"},{number:79,symbol:"Au",name:"ê¸ˆ",group:"transition-metal"},{number:80,symbol:"Hg",name:"ìˆ˜ì€",group:"transition-metal"},{number:81,symbol:"Tl",name:"íƒˆë¥¨",group:"post-transition-metal"},{number:82,symbol:"Pb",name:"ë‚©",group:"post-transition-metal"},{number:83,symbol:"Bi",name:"ë¹„ìŠ¤ë¬´íŠ¸",group:"post-transition-metal"},{number:84,symbol:"Po",name:"í´ë¡œëŠ„",group:"post-transition-metal"},{number:85,symbol:"At",name:"ì•„ìŠ¤íƒ€í‹´",group:"halogen"},{number:86,symbol:"Rn",name:"ë¼ëˆ",group:"noble-gas"},{number:87,symbol:"Fr",name:"í”„ë‘ìŠ˜",group:"alkali-metal"},{number:88,symbol:"Ra",name:"ë¼ë“",group:"alkaline-earth-metal"},{number:89,symbol:"Ac",name:"ì•…í‹°ëŠ„",group:"actinide"},{number:90,symbol:"Th",name:"í† ë¥¨",group:"actinide"},{number:91,symbol:"Pa",name:"í”„ë¡œíŠ¸ì•…í‹°ëŠ„",group:"actinide"},{number:92,symbol:"U",name:"ìš°ë¼ëŠ„",group:"actinide"},{number:93,symbol:"Np",name:"ë„µíˆ¬ëŠ„",group:"actinide"},{number:94,symbol:"Pu",name:"í”Œë£¨í† ëŠ„",group:"actinide"},{number:95,symbol:"Am",name:"ì•„ë©”ë¦¬ìŠ˜",group:"actinide"},{number:96,symbol:"Cm",name:"í€´ë¥¨",group:"actinide"},{number:97,symbol:"Bk",name:"ë²„í´ë¥¨",group:"actinide"},{number:98,symbol:"Cf",name:"ìº˜ë¦¬í¬ëŠ„",group:"actinide"},{number:99,symbol:"Es",name:"ì•„ì¸ìŠˆíƒ€ì´ëŠ„",group:"actinide"},{number:100,symbol:"Fm",name:"í˜ë¥´ë®´",group:"actinide"},{number:101,symbol:"Md",name:"ë©˜ë¸ë ˆë¸€",group:"actinide"},{number:102,symbol:"No",name:"ë…¸ë²¨ë¥¨",group:"actinide"},{number:103,symbol:"Lr",name:"ë¡œë ŒìŠ˜",group:"actinide"},{number:104,symbol:"Rf",name:"ëŸ¬ë”í¬ë“",group:"transition-metal"},{number:105,symbol:"Db",name:"ë”ë¸ŒëŠ„",group:"transition-metal"},{number:106,symbol:"Sg",name:"ì‹œë³´ê·¬",group:"transition-metal"},{number:107,symbol:"Bh",name:"ë³´ë¥¨",group:"transition-metal"},{number:108,symbol:"Hs",name:"í•˜ìŠ˜",group:"transition-metal"},{number:109,symbol:"Mt",name:"ë§ˆì´íŠ¸ë„ˆë¥¨",group:"unknown"},{number:110,symbol:"Ds",name:"ë‹¤ë¦„ìŠˆíƒ€íŠ¬",group:"unknown"},{number:111,symbol:"Rg",name:"ë¢´íŠ¸ê²ŒëŠ„",group:"unknown"},{number:112,symbol:"Cn",name:"ì½”í˜ë¥´ë‹ˆìŠ˜",group:"transition-metal"},{number:113,symbol:"Nh",name:"ë‹ˆí˜¸ëŠ„",group:"unknown"},{number:114,symbol:"Fl",name:"í”Œë ˆë¡œë¸€",group:"post-transition-metal"},{number:115,symbol:"Mc",name:"ëª¨ìŠ¤ì½”ë¸€",group:"unknown"},{number:116,symbol:"Lv",name:"ë¦¬ë²„ëª¨ë¥¨",group:"unknown"},{number:117,symbol:"Ts",name:"í…Œë„¤ì‹ ",group:"halogen"},{number:118,symbol:"Og",name:"ì˜¤ê°€ë„¤ì†",group:"noble-gas"}];
const cardDataString = `3   ìˆ˜ì†Œì—°ë£Œì „ì§€  ì¼ë°˜  ìˆ˜ì†Œì™€ ì‚°ì†Œì™€ ë°˜ì‘í•´ ë¬¼ê³¼ ì „ê¸°ì—ë„ˆì§€ë¥¼ ìƒì‚°í•©ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  8   O   ì‚°ì†Œ
3   ìš°ì£¼ì˜ êµ¬ì„±ì›ì†Œ    ì¼ë°˜  ë¹…ë±… ë‹¹ì‹œ ë§Œë“¤ì–´ì§„ ìˆ˜ì†Œì™€ í—¬ë¥¨ì—ì„œ ì‹œì‘í•´ ìš°ì£¼ì˜ ì—­ì‚¬ë¥¼ ì§€ë‚˜ë©° ë¬´ê¶ë¬´ì§„í•˜ê²Œ ë§ì€ ì›ì†Œê°€ ë§Œë“¤ì–´ì¡Œë„¤ìš”.  1   H   ìˆ˜ì†Œ  2   He  í—¬ë¥¨
1   í—¬ë¥¨ê°€ìŠ¤(í’ì„ )    ì¼ë°˜  ë°€ë„ê°€ ë‚®ì•„ í¡ì…í•˜ë©´ ëª©ì†Œë¦¬ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.  2   He  í—¬ë¥¨
4   ë¦¬íŠ¬ë°°í„°ë¦¬   ì¼ë°˜  ë™ì „ì²˜ëŸ¼ ìƒê¸´ ì „ì§€ê°€ ë³´í†µ ë¦¬íŠ¬ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ë°°í„°ë¦¬ì…ë‹ˆë‹¤.  3   Li  ë¦¬íŠ¬
5   ë¶•ì‚¬(ì•¡ì²´ê´´ë¬¼)    ì¼ë°˜  ì•¡ì²´ê´´ë¬¼ì˜ ë§ë‘ ì«€ë“í•œ ëŠë‚Œì€ ë¶•ì‚¬ ë•ë¶„ì— ê·¸ë ‡ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  5   B   ë¶•ì†Œ  8   O   ì‚°ì†Œ
3   ìº”   ì¼ë°˜  ì˜ íŒ½ì°½í•˜ê³ , ëª¨ì–‘ë„ ì¡ê¸° ì‰½ê³ , ì—´ì „ë„ìœ¨ë„ ë†’ì€ë° ìŒë£Œ ë³´ê´€ìš© ìº”ìœ¼ë¡œ í™œìš©í•˜ì§€ ì•Šì„ ì´ìœ ê°€ ìˆì„ê¹Œìš”?  13  Al  ì•Œë£¨ë¯¸ëŠ„
3   ê·¸ë˜í•€ ì¼ë°˜  ê°•ë„ê°€ ë§¤ìš° ê°•í•˜ë©°, ì°¨ì„¸ëŒ€ì˜ ë¬¼ì§ˆë¡œ ê°ê´‘ë°›ê³  ìˆìŠµë‹ˆë‹¤.  6   C   íƒ„ì†Œ
5   ì¸ì²´ë¥¼ êµ¬ì„±í•˜ëŠ” ëŒ€í‘œì›ì†Œ   ì¼ë°˜  ìœ ê¸° í™”í•™ì— ì…ë¬¸í•´ë³¼ ìƒê° ìˆìœ¼ì‹ ê°€ìš”? ì •ë§ ì¬ë¯¸ìˆìŠµë‹ˆë‹¤!  1   H   ìˆ˜ì†Œ  6   C   íƒ„ì†Œ  8   O   ì‚°ì†Œ
3   ì•”ëª¨ë‹ˆì•„    ì¼ë°˜  ìƒë¬¼ì€ ë‹¨ë°±ì§ˆì„ ì„­ì·¨ í›„ ë…ì„±ì´ ìˆëŠ” ì•”ëª¨ë‹ˆì•„ë¥¼ ë…ì„±ì´ ì ì€ ìš”ì†Œë‚˜ ìš”ì†Œë¡œ ëŒ€ì‚¬í•˜ì—¬ ì²´ì™¸ë¡œ ë°°ì„¤í•©ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  7   N   ì§ˆì†Œ
3   ë©”í…Œì¸ ì¼ë°˜  ì„¸ìƒì—ì„œ ê°€ì¥ ê°„ë‹¨í•œ íƒ„ì†Œ í™”í•©ë¬¼ë¡œ ì²œì—° ê°€ìŠ¤ì˜ ì£¼ ì„±ë¶„ì´ê¸°ë„ í•©ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  6   C   íƒ„ì†Œ
4   ì¶©ì¹˜ì˜ˆë°© ì¹˜ì•½ ì¼ë°˜  í”Œë£¨ì˜¤ë¦°í™” ë‚˜íŠ¸ë¥¨ì€ ì¹˜ì•„ í‘œë©´ì˜ ì„¸ê· ì„ ì–µì œí•˜ëŠ” ê¸°ëŠ¥ì´ ìˆì–´ ì¹˜ì•½ì´ë‚˜ ê°€ê¸€ì— ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.  9   F   í”Œë£¨ì˜¤ë¦°    11  Na  ë‚˜íŠ¸ë¥¨
2   ë„¤ì˜¨ì‚¬ì¸    ì¼ë°˜  ê¸°ë³¸ì ìœ¼ë¡œ ë„¤ì˜¨ì‚¬ì¸ì€ ì£¼í™©ìƒ‰ì´ì§€ë§Œ, ë” ë‹¤ì–‘í•œ ìƒ‰ì„ ë‚´ê³  ì‹¶ì„ ë• ì—¬ëŸ¬ê°€ì§€ ë‹¤ë¥¸ ê¸°ì²´ì™€ í˜¼í•©í•˜ê¸°ë„ í•©ë‹ˆë‹¤.  10  Ne  ë„¤ì˜¨
4   ì†Œê¸ˆ  ì¼ë°˜  ë‚˜íŠ¸ë¥¨ì€ í­ë°œì„±ì„ ì§€ë‹ˆê³ , ì—¼ì†ŒëŠ” ìœ ë…ê°€ìŠ¤ì¸ë° ì–´ì§¸ì„œ ê·¸ ë‘˜ì„ í•©ì¹œ ì†Œê¸ˆì€ ìŒì‹ì— ë„£ìœ¼ë©´ ë§›ìˆì–´ì§€ëŠ”ê±¸ê¹Œìš”?  11  Na  ë‚˜íŠ¸ë¥¨ 17  Cl  ì—¼ì†Œ
3   ì—¼ì‚°  ì¼ë°˜  êµê³¼ì„œ ì‹¤í—˜ì—ì„œ ë³´ë˜ ë…€ì„ì€ ë¬½ì€ ì—¼ì‚°ì´ì§€ë§Œ ì›ë˜ ì—¼ì‚°ì€ ì—„ì²­ë‚˜ê²Œ ê°•í•œ ê°•ì‚°ì´ë¼êµ¬ìš”!  1   H   ìˆ˜ì†Œ  17  Cl  ì—¼ì†Œ
6   ë‹¨ë°±ì§ˆ ì¼ë°˜  ì¸ì²´ë¥¼ êµ¬ì„±í•˜ëŠ” ì„¸í¬ì˜ ê±°ì˜ ëª¨ë“  ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë©”í‹°ì˜¤ë‹Œì´ë¼ëŠ” ì•„ë¯¸ë…¸ì‚°ì„ í¬í•¨í•œ ë‹¨ë°±ì§ˆì€ í™©(S)ì„ ê°€ì§‘ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  6   C   íƒ„ì†Œ  7   N   ì§ˆì†Œ  8   O   ì‚°ì†Œ  16  S   í™©
9   ATP ì¼ë°˜  ìƒëª…ì²´ì˜ ìƒëª…í™œë™ì— í•„ìš”í•œ ì—ë„ˆì§€ì›. ìƒë¬¼ì˜ íƒ„ìƒê³¼ í•¨ê»˜ ìƒëª…ì˜ ì—­ì‚¬ë¥¼ í•¨ê»˜í•œ í™”í•©ë¬¼.  1   H   ìˆ˜ì†Œ  6   C   íƒ„ì†Œ  7   N   ì§ˆì†Œ  8   O   ì‚°ì†Œ  15  P   ì¸
7   ë¹„ë£Œ  ì¼ë°˜  ë¹„ë£Œì˜ 3ëŒ€ ì›ì†Œì…ë‹ˆë‹¤. ì•ˆì •ì ìœ¼ë¡œ ë¹„ë£Œë¥¼ ìƒì‚° ê°€ëŠ¥í•´ì§„ ì‹œì ë¶€í„° ì„¸ê³„ ì¸êµ¬ê°€ í­ë°œì ìœ¼ë¡œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤.  7   N   ì§ˆì†Œ  15  P   ì¸   19  K   ì¹¼ë¥¨
6   ë°”ë‹¤ì˜ ì—¼ë¥˜  ì¼ë°˜  í•˜ë‹¤í•˜ë‹¤ ì´ì œ ë°”ë‹·ë¬¼ë„ ë§Œë“¤ì–´ ë‹¬ë¼êµ¬ìš”??  11  Na  ë‚˜íŠ¸ë¥¨ 12  Mg  ë§ˆê·¸ë„¤ìŠ˜    16  S   í™©   17  Cl  ì—¼ì†Œ
3   ì„¬ê´‘íƒ„ì˜ ê¸ˆì† ì¶©ì „  ì¼ë°˜  ë°˜ì‘ì„±ì´ ë†’ì€ ê¸ˆì†ì´ ìˆœì‹ê°„ì— ì‚°í™”ë˜ë©´ ê°•ë ¥í•œ ì„¬ê´‘ì´ ë°œìƒë©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ ì‹œê°ì„ ì¼ì‹œì ìœ¼ë¡œ ì •ì§€ì‹œì¼œìš”.  12  Mg  ë§ˆê·¸ë„¤ìŠ˜    13  Al  ì•Œë£¨ë¯¸ëŠ„
3   ë³´í˜¸ìš© ê¸°ì²´  ì¼ë°˜  ì–´ë–¤ ë¬¼ì²´ë¥¼ ì‚°ì†Œë‚˜ ë‹¤ë¥¸ ë°˜ì‘ì„±ì´ ìˆëŠ” ê¸°ì²´ë¡œë¶€í„° ë³´í˜¸í•  ë•Œ ë°˜ì‘ì„±ì´ ë§¤ìš° ì ì€ ì•„ë¥´ê³¤ì„ ì´ìš©í•˜ê¸°ë„ í•©ë‹ˆë‹¤.  18  Ar  ì•„ë¥´ê³¤
6   ëŒ€ê¸°  ì¼ë°˜  ì¸ë¥˜ë„ ì–¸ì  ê°€ ì¸ê³µ ëŒ€ê¸°ë¥¼ ë§Œë“¤ì–´ ë‹¤ë¥¸ í–‰ì„±ì„ í…Œë¼í¬ë° í•˜ëŠ” ë‚ ì´ ì˜¤ê² ì£ ?  7   N   ì§ˆì†Œ  8   O   ì‚°ì†Œ  18  Ar  ì•„ë¥´ê³¤
6   í™”ì•½  ì¼ë°˜  ì ì ˆí•œ ì—°ë£Œë§Œ ì¡´ì¬í•œë‹¤ë©´, ì—°ì†Œì˜ ì†ë„ê°€ ë§¤ìš° ë¹ ë¥¸ ì§ˆì‚°ì¹¼ë¥¨ì„ í™œìš©í•´ í™”ì•½ì„ ì œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  7   N   ì§ˆì†Œ  8   O   ì‚°ì†Œ  19  K   ì¹¼ë¥¨
5   ì¸ì‚°ê¸°, ì¸ì‚°ì—¼    ì¼ë°˜  ë¼ˆì™€ ì¹˜ì•„ë¥¼ êµ¬ì„±í•˜ê¸°ë„ í•˜ê³ , ì˜í•™ ë° ìƒë¬¼í•™ ë¶„ì•¼ì—ì„œ í™œë°œí•˜ê²Œ ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì´ìš©ë©ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  8   O   ì‚°ì†Œ  15  P   ì¸
4   ìœ ë¦¬  ì¼ë°˜  ë‹¤ì–‘í•œ ê±´ì¶•ë¬¼, ì‚°ì—…ì— ì´ìš©ë˜ëŠ” ìœ ë¦¬ëŠ” ì´ì‚°í™”ê·œì†Œë¡œ ì£¼ë¡œ ì œì‘í•©ë‹ˆë‹¤.  8   O   ì‚°ì†Œ  14  Si  ê·œì†Œ
5   ì—¼í™” ì¹¼ìŠ˜   ì¼ë°˜  ë¬¼ì— ë…¹ìœ¼ë©´ ì–´ëŠ”ì ì„ í¬ê²Œ ë‚®ì¶°ì£¼ì–´ í”íˆ ì œì„¤ìš©ìœ¼ë¡œ ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.  17  Cl  ì—¼ì†Œ  20  Ca  ì¹¼ìŠ˜
5   í™©ì‚°  ì¼ë°˜  ëŒ€í‘œì ì¸ ê°•ì‚°ìœ¼ë¡œ ê° ë‚˜ë¼ì˜ í™©ì‚° ìƒì‚°ëŸ‰ì´ ê·¸ ë‚˜ë¼ì˜ í™”í•™ ì‚°ì—… ê·œëª¨ë¥¼ ë‚˜íƒ€ë‚´ê¸°ë„ í•©ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  8   O   ì‚°ì†Œ  16  S   í™©
7   ë½ìŠ¤  ì¼ë°˜  ì°¨ì•„ì—¼ì†Œì‚°ë‚˜íŠ¸ë¥¨ì„ ë¬¼ì— ë…¹ì¸ ìˆ˜ìš©ì•¡ì„ ëœ»í•©ë‹ˆë‹¤. ì£¼ë°©, ìš•ì‹¤, ìˆ˜ì˜ì¥ ë“± ê°€ì¥ ë§ì´ ì“°ì´ëŠ” ì‚´ê· ì†Œë…ìš© ë¬¼ì§ˆì´ê¸°ë„ í•©ë‹ˆë‹¤.  8   O   ì‚°ì†Œ  11  Na  ë‚˜íŠ¸ë¥¨ 17  Cl  ì—¼ì†Œ
2   ë¼ˆ   ì¼ë°˜  ë¼ˆë¥¼ êµ¬ì„±í•˜ëŠ” ì›ì†Œì—¬ì„œ ì„­ì·¨ê°€ ì¤‘ìš”í•˜ë‹¤ê³  ì—¬ê²¨ì§€ì§€ë§Œ ì‹ ê²½ ë° ê·¼ìœ¡ ë°˜ì‘ì—ë„ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì¤‘ìš”í•œ ì›ì†Œì…ë‹ˆë‹¤.  20  Ca  ì¹¼ìŠ˜
6   ë¶„í•„ê³¼ ì¡°ê°œê»ì§ˆ    ì¼ë°˜  íƒ„ì‚°ì¹¼ìŠ˜ì€ ëŒ€ë¦¬ì„, ë‹¬ê±€, ì¡°ê°œê»ì§ˆì˜ ì„±ë¶„ì…ë‹ˆë‹¤. ì‚°ì„± ë¬¼ì§ˆê³¼ ë§Œë‚˜ë©´ ê±°í’ˆì„ ë‚´ë©° ë°˜ì‘í•©ë‹ˆë‹¤.  6   C   íƒ„ì†Œ  8   O   ì‚°ì†Œ  20  Ca  ì¹¼ìŠ˜
8   ì—ë©”ë„ë“œ    ì¼ë°˜  ê´‘ë¬¼ê³¼ ë³´ì„ë“¤ë„ ë‹¤ì–‘í•œ ì›ì†Œë¡œ ì´ë£¨ì–´ì ¸ìˆë‹¤ëŠ” ì‚¬ì‹¤!  4   Be  ë² ë¦´ë¥¨ 8   O   ì‚°ì†Œ  13  Al  ì•Œë£¨ë¯¸ëŠ„    14  Si  ê·œì†Œ
4   ì§ˆì†Œìˆœí™˜íš¨ì†Œì˜ ë³´ì¡°ì¸ì    ê³ ê¸‰  ìƒì²´ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ íš¨ì†Œì— í¬í•¨ëœ í•„ìˆ˜ì ì¸ ì›ì†Œì…ë‹ˆë‹¤. ì‹ë¬¼ì˜ ì§ˆì†Œê³ ì • ì‘ìš©ê³¼ ì—°ê´€ëœ íš¨ì†Œì˜ ë³´ì¡°ì¸ìë¡œ ì‘ìš©í•©ë‹ˆë‹¤.  42  Mo  ëª°ë¦¬ë¸Œë°ë„˜
3   ë™ìƒ  ê³ ê¸‰  ëœë“œë§ˆí¬, ìš°ìƒí™”, ìœ„ì¸ ë“± ê¸°ë…ì„±ì´ í•„ìš”í•œ ë°ì—ëŠ” ë™ìƒì´ì£ . ë¶í•œì´ ë™ìƒê¸°ìˆ  ê°•êµ­ì´ê¸°ë„ í•©ë‹ˆë‹¤.  29  Cu  êµ¬ë¦¬
4   ì•¼ê´‘ ë¬¼ì§ˆ   ê³ ê¸‰  ì•¼ê´‘ ì„±ì§ˆì„ ë‚˜íƒ€ë‚´ëŠ” ìŠ¤íŠ¸ë¡ íŠ¬ í™”í•©ë¬¼ì€ ë¹›ì„ ë°›ì•„ ì´‰ê´‘ ìƒíƒœê°€ ë˜ë©´, ì–´ë‘ì›Œì§€ë”ë¼ë„ í¬ë¯¸í•˜ê²Œ ë¹›ì„ ë‚´ë¿œë‹¤ ì–´ë‘ì›Œì§‘ë‹ˆë‹¤.  38  Sr  ìŠ¤íŠ¸ë¡ íŠ¬
3   ê²Œë¥´ë§ˆëŠ„ íŒ”ì°Œ ê³ ê¸‰  ê³¼í•™ì„ ë°°ìš´ ì¹œêµ¬ë“¤ì´ë¼ë©´ ì‚¬ê¸°ë€ ê±° ì•Œì£ ??  32  Ge  ì €ë§ˆëŠ„
3   ì „êµ¬ì˜ í•„ë¼ë©˜íŠ¸    ê³ ê¸‰  ì „ê¸°ì €í•­ë„ ì»¤ì„œ ë°ì€ ë¹›ì„ ë‚¼ ìˆ˜ë„ ìˆê³ , ë…¹ëŠ” ì˜¨ë„ë„ ë†’ìœ¼ë‹ˆ ì „êµ¬ì— í•„ë¼ë©˜íŠ¸ë¡œ ì œê²©ì´ì£ .  74  W   í……ìŠ¤í…
4   ë¼ëˆì„ í¬ì§‘í•´ì£¼ì„¸ìš”  ê³ ê¸‰  ì§€êµ¬ìƒ ì–´ë””ì—ë‚˜ ì¡´ì¬í•˜ëŠ” ìì—° ë°©ì‚¬ì„± ë¬¼ì§ˆì…ë‹ˆë‹¤. ìƒˆì§‘ì¦í›„êµ°ê³¼ë„ ì—°ê´€ ìˆì–´ ë…¸ì¶œë˜ë©´ íì•”ì„ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  86  Rn  ë¼ëˆ
3   ê³ ê¸‰ ì•ˆê²½í…Œ  ê³ ê¸‰  ë‚´ì‹ì„±ì´ ìš°ìˆ˜í•´ ë¶€ì‹ì´ ì˜ ë˜ì§€ ì•Šìœ¼ë©° ê°•í•œ ì¶©ê²©ì—ë„ ì˜ ë¶€ëŸ¬ì§€ì§€ ì•Šì•„ ì•ˆê²½í…Œë¡œ í™œìš©ë©ë‹ˆë‹¤.  22  Ti  í‹°íƒ€ëŠ„
5   ìš°ì£¼ ê±°ìš¸   ê³ ê¸‰  ë² ë¦´ë¥¨ì€ ê°€ë³ê³  ì—´íŒ½ì°½ë¥ ì´ ë‚®ì•„ ìš°ì£¼ë¡œ ë°œì‚¬ë˜ëŠ” ë°˜ì‚¬ ë§ì›ê²½ ê±°ìš¸ì— í™œìš©ë©ë‹ˆë‹¤. ì œì„ìŠ¤ì›¹ì€ ì—¬ê¸°ì— ê¸ˆ ë„ê¸ˆì´ ë˜ì—ˆì£ .  4   Be  ë² ë¦´ë¥¨ 79  Au  ê¸ˆ
5   ê°€ë²¼ìš´ í•©ê¸ˆ  ê³ ê¸‰  ìŠ¤ì¹¸ë“-ì•Œë£¨ë¯¸ëŠ„ í•©ê¸ˆì€ ê°€ë³ê³  ê°•ë„ì™€ ë‚´êµ¬ì„±ì´ ì¢‹ì•„ í•­ê³µê¸° ë¶€í’ˆì´ë‚˜ ìì „ê±° í”„ë ˆì„ìœ¼ë¡œ ë§ì´ í™œìš©ë©ë‹ˆë‹¤.  13  Al  ì•Œë£¨ë¯¸ëŠ„    21  Sc  ìŠ¤ì¹¸ë“
6   ê³ ì„±ëŠ¥ ì¡°ëª…ê¸°ì²´    ê³ ê¸‰  ì¹´ë©”ë¼ í”Œë˜ì‹œë‚˜ ë“±ëŒ€ì˜ ë¶ˆë¹›ì— ë§ì´ ì‚¬ìš©ë˜ëŠ” ì´ë“¤ ê¸°ì²´ëŠ” ë°˜ì‘ì„±ì´ ê±°ì˜ ì—†ì–´ ì¡°ëª…ì˜ ì¶©ì „ì¬ë¡œ í™œìš©ë©ë‹ˆë‹¤.  36  Kr  í¬ë¦½í†¤ 54  Xe  ì œë…¼
4   ìˆ˜ì •í…Œì´í”„, í° ë¬¼ê° ê³ ê¸‰  ì´ì‚°í™”í‹°íƒ€ëŠ„ì€ í°ìƒ‰ì˜ í™”í•©ë¬¼ë¡œ í˜ì¸íŠ¸, ìˆ˜ì •í…Œì´í”„ ë° ì„ í¬ë¦¼ì— ì¢…ì¢… ì´ìš©ë©ë‹ˆë‹¤.  8   O   ì‚°ì†Œ  22  Ti  í‹°íƒ€ëŠ„
5   ì‹¤ì˜¨ì—ì„œ ì•¡ì²´ì¸ ë¬¼ì§ˆ ê³ ê¸‰  ìˆ˜ì€ì€ ì˜¨ë„ê³„ë¡œë„ ì´ìš©ë˜ì§€ìš”? ì£¼ê¸°ìœ¨í‘œ ìƒì—ì„œ ê½¤ ë–¨ì–´ì§„ ë‘ ì›ì†Œê°€ ë¹„ìŠ·í•œ ì„±ì§ˆì„ ê°–ê³  ìˆë‹¤ë‹ˆ ì‹ ê¸°í•˜ì§€ ì•Šë‚˜ìš”?  35  Br  ë¸Œë¡œë¯¼ 80  Hg  ìˆ˜ì€
5   ë…¸ë€ìƒ‰ ë¬¼ê°  ê³ ê¸‰  ë‘ ì›ì†ŒëŠ” ë…¸ë€ìƒ‰ì„ ë‚´ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ëŒ€í‘œì ì¸ ì—¼ë£Œì…ë‹ˆë‹¤.  24  Cr  í¬ë¡œë®´ 48  Cd  ì¹´ë“œë®´
5   ë„ˆ ê·€ì—¬ì›Œ   ê³ ê¸‰  ê³¼í•™ì„ ì¢‹ì•„í•˜ëŠ” ì´ì„±ì¹œêµ¬ë¥¼ ë§Œë‚˜ê³  ì‹¶ë‹¤ê³ ìš”? ë„Œ êµ¬ë¦¬ì™€ í…”ë£¨ë¥¨ìœ¼ë¡œ êµ¬ì„±ëœ ê²ƒ ê°™ì•„!ë¼ê³  í”ŒëŸ¬íŒ… í•´ë³´ì„¸ìš”!  29  Cu  êµ¬ë¦¬  52  Te  í…”ë£¨ë¥¨
6   ê±´ì „ì§€ ê³ ê¸‰  ë§ê°€ë‹ˆì¦ˆ ê±´ì „ì§€ëŠ” ì¼ì°¨ ì „ì§€ ì¤‘ í•˜ë‚˜ë¡œ, ì „í•´ì§ˆ ì†ì—ì„œ ì•„ì—°ê³¼ ì´ì‚°í™” ë§ê°€ë‹ˆì¦ˆ ê°„ì˜ ì „ê¸°í™”í•™ ë°˜ì‘ìœ¼ë¡œ ì—ë„ˆì§€ë¥¼ ê³µê¸‰í•©ë‹ˆë‹¤.  25  Mn  ë§ê°€ë‹ˆì¦ˆ    30  Zn  ì•„ì—°
5   ê´‘ì„¬ìœ  ê³ ê¸‰  í•œ ë²ˆ ì„¬ìœ  ë‚´ë¡œ ë“¤ì–´ê°„ ë¹›ì´ ë‚´ë¶€ì—ì„œ ì „ë°˜ì‚¬ë¥¼ í†µí•´ ë°˜ëŒ€í¸ìœ¼ë¡œ ë‚˜ê°‘ë‹ˆë‹¤. ë°ì´í„° ì†ì‹¤ì´ ì ì–´ í†µì‹ ì— í™œìš©ë©ë‹ˆë‹¤.  14  Si  ê·œì†Œ  32  Ge  ì €ë§ˆëŠ„
5   ë¹„ë“ ìƒ´í‘¸   ê³ ê¸‰  í™©í™”ì…€ë ˆëŠ„ì€ ë¯¸ìƒë¬¼ì— ì˜í•œ í”¼ë¶€ì—¼Â·ë¹„ë“¬ì„ ì¹˜ë£Œí•˜ëŠ” ìƒ´í‘¸ ë“±ì— ì‚¬ìš©ë©ë‹ˆë‹¤.  16  S   í™©   34  Se  ì…€ë ˆëŠ„
6   ë¸Œë¡œë§ˆì´ë“œ   ê³ ê¸‰  ë¸Œë¡œë¯¼í™”ì€(AgBr)ì„ ì‚¬ìš©í•œ ì¸í™”ì§€ë¡œ ì¸ì‡„í•œ ì‚¬ì§„ì„ ì§€ì¹­í•©ë‹ˆë‹¤. ìµœê·¼ì—ëŠ” ì—°ì˜ˆì¸ ë•ì§ˆìš© ì‚¬ì§„ì„ ëœ»í•˜ê¸°ë„ í•˜ì£ .  35  Br  ë¸Œë¡œë¯¼ 47  Ag  ì€
6   ì¸ê³µì¹˜ì•„    ê³ ê¸‰  ì„í”Œë€íŠ¸(í¬ë¼ìš´)ì— ì“°ì´ëŠ” ì¸ê³µì¹˜ì•„ ì¬ë£Œ ì›ì†Œë“¤ì…ë‹ˆë‹¤.  40  Zr  ì§€ë¥´ì½”ëŠ„    79  Au  ê¸ˆ
7   ë§Œë…„í•„ íœì´‰  ê³ ê¸‰  ê³ ê¸‰ ë§Œë…„í•„ì— í™œìš©ë˜ëŠ” ê¸ˆì† ì›ì†Œë“¤ì…ë‹ˆë‹¤. ì˜¤ëœ ê¸°ê°„ ì‚¬ìš©í•´ë„ í•„ê¸°ê°ì´ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.  44  Ru  ë£¨í…ŒëŠ„ 76  Os  ì˜¤ìŠ¤ë¸€
5   ë‚©ë•œ  ê³ ê¸‰  ë‘ ê°œ ì´ìƒì˜ ë¬¼ì§ˆì„ ê²°í•©í•˜ëŠ” ê¸°ì´ˆì ì¸ ìš©ì ‘ë²•ìœ¼ë¡œ, ì¸ë¥˜ì˜ ì—­ì‚¬ì™€ í•¨ê»˜í•´ì˜¨ ê¸°ìˆ ì…ë‹ˆë‹¤.  50  Sn  ì£¼ì„  82  Pb  ë‚©
5   ìƒë³€í™” ë©”ëª¨ë¦¬ ê³ ê¸‰  ë¹„íœ˜ë°œì„±ê³¼ ë¹ ë¥¸ ì†ë„ì˜ ì¥ì ì„ ê°€ì§„ ì°¨ì„¸ëŒ€ ë©”ëª¨ë¦¬ ë°˜ë„ì²´ì…ë‹ˆë‹¤.  51  Sb  ì•ˆí‹°ëª¨ë‹ˆ    52  Te  í…”ë£¨ë¥¨
4   ì•„ì´ì˜¤ë”˜í™” ì¹¼ë¥¨    ê³ ê¸‰  ë…¹ë§ê³¼ ë°˜ì‘í•˜ë©´ ì²­ëŒìƒ‰ìœ¼ë¡œ ë³€í•´ ì˜ì–‘ì†Œ ê²€ì¶œ ì‹¤í—˜ì— ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.  19  K   ì¹¼ë¥¨  53  I   ì•„ì´ì˜¤ë”˜
5   ë§ì´ ì´ìš©ë˜ëŠ” ê¸ˆì†ì›ì†Œ    ê³ ê¸‰  ë¹„ë£Œì˜ 3ëŒ€ ì›ì†Œë¡œ, ì•ˆì •ì  ë¹„ë£Œ ìƒì‚°ì´ ê°€ëŠ¥í•´ì§„ ì´í›„ ì„¸ê³„ ì¸êµ¬ê°€ í­ë°œì ìœ¼ë¡œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤.  12  Mg  ë§ˆê·¸ë„¤ìŠ˜    13  Al  ì•Œë£¨ë¯¸ëŠ„    26  Fe  ì² 
8   ë°˜ë„ì²´ì— ì´ìš©ë˜ëŠ” ì›ì†Œ    ê³ ê¸‰  ë¬¼ë¦¬í•™ ì—­ì‚¬ìƒ ê°€ì¥ ì‹¤ìš©ì ì´ë©°, í˜„ëŒ€ ì •ë³´ ì‚°ì—…ì˜ ê¸°ì´ˆê°€ ëœ ë¬¼ì²´ë“¤ì…ë‹ˆë‹¤.  14  Si  ê·œì†Œ  32  Ge  ì €ë§ˆëŠ„ 51  Sb  ì•ˆí‹°ëª¨ë‹ˆ
8   ë¶ˆê½ƒë†€ì´    ê³ ê¸‰  í­ë°œì€ ì˜ˆìˆ ì´ì£ . ì´ ì™¸ì—ë„ ë‹¤ì–‘í•œ ì›ì†Œë“¤ì´ í™œìš©ë©ë‹ˆë‹¤.  22  Ti  í‹°íƒ€ëŠ„ 38  Sr  ìŠ¤íŠ¸ë¡ íŠ¬    56  Ba  ë°”ë¥¨
5   ì‹í’ˆì˜ ì˜¤ì—¼ ì§€í‘œ   ê³ ê¸‰  ë°©ì‚¬ëŠ¥ ì‚¬ê³  ì‹œ ë°©ì‚¬ì„ ì„ ê°€ì¥ ë§ì´ ë°©ì¶œí•˜ëŠ” ì•„ì´ì˜¤ë”˜ê³¼ ì„¸ìŠ˜ì„ ì‹í’ˆ ì˜¤ì—¼ ì§€í‘œë¡œ í™œìš©í•©ë‹ˆë‹¤.  53  I   ì•„ì´ì˜¤ë”˜    55  Cs  ì„¸ìŠ˜
6   í€´ë¦¬ ë¶€ë¶€ì˜ ì—­ì‚¬ ë“œë¼ë§ˆ   ê³ ê¸‰  í€´ë¦¬ ë¶€ë¶€ê°€ ë°œê²¬í•œ ë°©ì‚¬ì„± ì›ì†Œë“¤ì…ë‹ˆë‹¤. ìœ„í—˜í•œ ë“œë¼ë§ˆ ì´¬ì˜ì€ í”¼í•´ì•¼ê² ì£ ?  84  Po  í´ë¡œëŠ„ 88  Ra  ë¼ë“
9   í•µ ì œì–´ë´‰   ê³ ê¸‰  ì—°ì‡„ í•µë¶„ì—´ ì†ë„ë¥¼ ì¡°ì ˆí•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì¤‘ì„±ìë¥¼ ì˜ í¡ìˆ˜í•˜ëŠ” ì›ì†Œë“¤ì´ì£ .  5   B   ë¶•ì†Œ  47  Ag  ì€   72  Hf  í•˜í”„ëŠ„
7   ìŠ¤í…Œì¸ë¦¬ìŠ¤   ê³ ê¸‰  ë…¹ì´ ê±°ì˜ ìŠ¬ì§€ ì•ŠëŠ” í•©ê¸ˆì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ê¸ˆì† ì œí’ˆì— í™œìš©ë©ë‹ˆë‹¤.  24  Cr  í¬ë¡œë®´ 26  Fe  ì²    28  Ni  ë‹ˆì¼ˆ
7   ëŒ€í‘œì ì¸ ìì„± ì›ì†Œ  ê³ ê¸‰  ë„¤ì˜¤ë””ë®´(Nd)ë„ í¬í•¨ë©ë‹ˆë‹¤. ìì„ì„ ìª¼ê°œë©´ ë˜ë‹¤ì‹œ ë‘ ê·¹ì´ ìƒê¸°ì£ . ì´ë¡ ìƒ ë¶„ë¦¬ëŠ” ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.  26  Fe  ì²    27  Co  ì½”ë°œíŠ¸ 28  Ni  ë‹ˆì¼ˆ
6   ë™ì „  ê³ ê¸‰  ì¸ë¥˜ ì—­ì‚¬ìƒ ê°€ì¥ ì¢‹ì€ ì¹œêµ¬ì´ì£ . ë°œí–‰ ë¹„ìš© ë•Œë¬¸ì— ì§€íë¡œ ë„˜ì–´ê°€ëŠ” ì¶”ì„¸ì…ë‹ˆë‹¤.  28  Ni  ë‹ˆì¼ˆ  29  Cu  êµ¬ë¦¬  30  Zn  ì•„ì—°
7   ê°ˆë¦°ìŠ¤íƒ„    ê³ ê¸‰  ë…ì„±ì´ ì ì–´ ìˆ˜ì€ ëŒ€ì²´ì œë¡œ, ëƒ‰ê°ì¬Â·ì²´ì˜¨ê³„ ì¬ë£Œë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.  31  Ga  ê°ˆë¥¨  49  In  ì¸ë“  50  Sn  ì£¼ì„
8   ë…ì•½  ê³ ê¸‰  ëŒ€í‘œì  ë§¹ë…ìœ¼ë¡œ, ì—­ì‚¬ì ìœ¼ë¡œ ì•”ì‚´ì— ë§ì´ ì´ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.  33  As  ë¹„ì†Œ  81  Tl  íƒˆë¥¨  84  Po  í´ë¡œëŠ„
8   ëª©ì†Œë¦¬ë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ê¸°ì²´   ê³ ê¸‰  ë¹„í™œì„± ê¸°ì²´ë¡œ í¡ì… ì‹œ ì§„ë™ìˆ˜ë¥¼ ë°”ê¿” ëª©ì†Œë¦¬ë¥¼ ë†’ì´ê±°ë‚˜ ë‚®ì¶¥ë‹ˆë‹¤.  2   He  í—¬ë¥¨  36  Kr  í¬ë¦½í†¤ 54  Xe  ì œë…¼
8   íŒŒë€ìƒ‰ í¬ë ˆíŒŒìŠ¤    ê³ ê¸‰  ì¸ë§ ë¸”ë£¨ë¼ê³  ë¶ˆë¦¬ëŠ” í™”í•©ë¬¼ì´ ë” ê°•í•œ íŒŒë€ìƒ‰ì„ ë‚˜íƒ€ë‚´ í¬ë ˆíŒŒìŠ¤ë¡œ ì´ìš©ë©ë‹ˆë‹¤.  25  Mn  ë§ê°€ë‹ˆì¦ˆ    39  Y   ì´íŠ¸ë¥¨ 49  In  ì¸ë“
8   ì´ˆì „ë„ ìì„  ê³ ê¸‰  ì•ˆì •ì  ìê¸°ì¥ì„ ì–»ì„ ìˆ˜ ìˆê³ , ì†Œëª¨ì „ë ¥ì´ ì ì–´ ë¯¸ë˜ ê³¼í•™ê¸°ìˆ ì˜ í•µì‹¬ ì†Œì¬ì…ë‹ˆë‹¤.  22  Ti  í‹°íƒ€ëŠ„ 41  Nb  ë‚˜ì´ì˜¤ë¸€    50  Sn  ì£¼ì„
9   ë°©ì‚¬ì„  ì§„ë‹¨  ê³ ê¸‰  ì•”Â·ë‚œì¹˜ì„± ì§ˆí™˜ ì§„ë‹¨ì„ ìœ„í•œ í•µì˜í•™ ì˜ìƒê²€ì‚¬ì— ì‚¬ìš©ë˜ëŠ” ë°©ì‚¬ì„± ì›ì†Œë“¤ì…ë‹ˆë‹¤.  43  Tc  í…Œí¬ë„¤íŠ¬    53  I   ì•„ì´ì˜¤ë”˜    83  Bi  ë¹„ìŠ¤ë¬´íŠ¸
9   ë°°ê¸°ê°€ìŠ¤ ì œê±° ì´‰ë§¤  ê³ ê¸‰  ë¡œë“ì€ ì§ˆì†Œì‚°í™”ë¬¼, íŒ”ë¼ë“ê³¼ ë°±ê¸ˆì€ íƒ„ì†Œí™”í•©ë¬¼ì„ ì•ˆì „í•œ ë¬¼ì§ˆë¡œ ì „í™˜í•©ë‹ˆë‹¤.  45  Rh  ë¡œë“  46  Pd  íŒ”ë¼ë“ 78  Pt  ë°±ê¸ˆ
7   ê·€ê¸ˆì† ê³ ê¸‰  ì¥ì‹ìš©Â·íˆ¬ììš©ìœ¼ë¡œ í¬ê·€í•˜ë©°, ì‚°í™”ê°€ ê±°ì˜ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ” ê¸ˆì†ë“¤ì…ë‹ˆë‹¤.  47  Ag  ì€   78  Pt  ë°±ê¸ˆ  79  Au  ê¸ˆ
8   ë‹´ë°°ì˜ ì¤‘ê¸ˆì†ì„ ì—†ì• ì£¼ì„¸ìš”  ê³ ê¸‰  ë°±í•´ë¬´ìµí•œ ë‹´ë°°â€¦ ì´ë˜ë„ í”¼ìš´ë‹¤êµ¬ìš”?  48  Cd  ì¹´ë“œë®´ 80  Hg  ìˆ˜ì€  82  Pb  ë‚©
8   í”Œë£¨ì˜¤ë¡œì•ˆí‹°ëª¬ì‚°    ê³ ê¸‰  ì§€ê¸ˆê¹Œì§€ ë°œê²¬ëœ ë³´ê´€ ê°€ëŠ¥í•œ í™”í•©ë¬¼ ì¤‘ ê°€ì¥ ë†’ì€ ì‚°ë„ë¥¼ ê°€ì§€ë©° ê±°ì˜ ëª¨ë“  ìœ ê¸°í™”í•©ë¬¼ì„ ë…¹ì—¬ë²„ë¦½ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  9   F   í”Œë£¨ì˜¤ë¦°    51  Sb  ì•ˆí‹°ëª¨ë‹ˆ
7   tert-ë¶€í‹¸ë¦¬íŠ¬   ê³ ê¸‰  ì§€ê¸ˆê¹Œì§€ ë°œê²¬ëœ í™”í•©ë¬¼ ì¤‘ ê°€ì¥ ë†’ì€ ì—¼ê¸°ë¥¼ ê°€ì§€ë©° ìœ ê¸°í™”í•©ë¬¼ì„ ë…¹ì—¬ë²„ë¦½ë‹ˆë‹¤.  1   H   ìˆ˜ì†Œ  3   Li  ë¦¬íŠ¬  6   C   íƒ„ì†Œ
9   ë°˜ê°ê¸°ê°€ ì§§ì€ ì›ì†Œ  ê³ ê¸‰  ë°˜ê°ê¸°ê°€ ë„ˆë¬´ ì§§ì•„ ìƒì„±ë˜ìë§ˆì ë¶•ê´´í•´ë²„ë¦¬ëŠ” ì›ì†Œë“¤ì…ë‹ˆë‹¤.  75  Re  ë ˆëŠ„  85  At  ì•„ìŠ¤íƒ€í‹´    87  Fr  í”„ë‘ìŠ˜
8   ì§€êµ¬ì˜ êµ¬ì„±ì„±ë¶„    ê³ ê¸‰  ì§€êµ¬ë¥¼ êµ¬ì„±í•˜ëŠ” ì£¼ìš” ì›ì†Œë“¤ì…ë‹ˆë‹¤.  8   O   ì‚°ì†Œ  12  Mg  ë§ˆê·¸ë„¤ìŠ˜    14  Si  ê·œì†Œ  26  Fe  ì² 
9   ì—”ì§„ì˜ í•©ê¸ˆ  ê³ ê¸‰  ì´ë“¤ë¡œ ì´ë¤„ì§„ í•©ê¸ˆì€ ë‚´ì—´ì„±ì´ ë§¤ìš° ë†’ì•„ ì—”ì§„ìš© ê¸ˆì†ìœ¼ë¡œ í™œìš©ë˜ê¸°ì— ì¶©ë¶„í•©ë‹ˆë‹¤.  23  V   ë°”ë‚˜ë“ 24  Cr  í¬ë¡œë®´ 26  Fe  ì²    28  Ni  ë‹ˆì¼ˆ
7   ì „ì„   ê³ ê¸‰  ì „ê¸°ê°€ ì˜ íë¥´ëŠ” ì´ë“¤ ì›ì†ŒëŠ” ì „ì„ ì— íŠ¹íˆ ë§ì´ ì´ìš©ë©ë‹ˆë‹¤.  13  Al  ì•Œë£¨ë¯¸ëŠ„    29  Cu  êµ¬ë¦¬  47  Ag  ì€   79  Au  ê¸ˆ
8   ë¶„ìŸê´‘ë¬¼ì„ êµ¬í•´ì£¼ì„¸ìš” ê³ ê¸‰  ë¬´ì¥ì„¸ë ¥ì´ ì´ ê´‘ë¬¼ì˜ ìœ í†µê³¼ ì±„êµ´ì„ ì¥ì•…í•´ ì¸ê¶Œë¬¸ì œë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.  50  Sn  ì£¼ì„  73  Ta  íƒ„íƒˆëŸ¼ 74  W   í……ìŠ¤í… 79  Au  ê¸ˆ
9   ë‚´ì—´ì„±ì´ ë†’ì€ ì›ì†Œ  ê³ ê¸‰  ë‚´ì—´ì„±ì´ ë§¤ìš° ë†’ì•„ ê´€ë ¨ ì„±ì§ˆì„ í•„ìš”ë¡œ í•˜ëŠ” ì‚°ì—…ì— ìì£¼ ì´ìš©ë˜ëŠ” ì›ì†Œì…ë‹ˆë‹¤.  74  W   í……ìŠ¤í… 75  Re  ë ˆëŠ„  76  Os  ì˜¤ìŠ¤ë®´ 77  Ir  ì´ë¦¬ë“
0   í•µë¬´ê¸° ê³ ê¸‰  ì´ ì¹´ë“œëŠ” ì£¼ì‚¬ìœ„ ê°’(89~103)ì— íë¸Œê°€ ìˆë‹¤ë©´ ìƒì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  92  U   ìš°ë¼ëŠ„ 94  Pu  í”Œë£¨í† ëŠ„
`;

// --- GLOBAL STATE & CONFIG ---
let gameState = {};
const playerColors = ['red', 'blue', 'green', 'yellow', 'purple', 'pink'];
const allDiceTypes = ['d4', 'd6', 'd8', 'd10', 'd12', 'd20', 'd%'];
const diceNames = {
    'd4': 'ì‚¬ë©´ì²´', 'd6': 'ìœ¡ë©´ì²´', 'd8': 'íŒ”ë©´ì²´', 'd10': 'ì‹­ë©´ì²´',
    'd12': 'ì‹­ì´ë©´ì²´', 'd20': 'ì´ì‹­ë©´ì²´', 'd%': 'ë°±ë¶„ìœ¨'
};
const technologies = {
    multiply: { id: 'multiply', name: 'ê³±ì…ˆ/ë‚˜ëˆ—ì…ˆ', icon: 'âœ¶', desc: "+, â€“ ëŒ€ì‹  Ã— ë˜ëŠ” Ã· ì—°ì‚°ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
    concat: { id: 'concat', name: 'ìë¦¬ë¶™ì´ê¸°', icon: 'â§–', desc: "ë‘ ì£¼ì‚¬ìœ„ ëˆˆì„ ì´ì–´ ë¶™ì—¬ ë‘ ìë¦¿ìˆ˜ë¥¼ ë§Œë“­ë‹ˆë‹¤." },
    slide: { id: 'slide', name: 'ìŠ¬ë¼ì´ë“œ', icon: 'â†”', desc: "íë¸Œ ë°°ì¹˜ í›„, ë‚´ íë¸Œ ì¤‘ 1ê°œë¥¼ ì¸ì ‘í•œ(ìì‹ ì˜ íë¸Œê°€ ì—†ëŠ”) ì¹¸ìœ¼ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤." },
    outsource: { id: 'outsource', name: 'ì™¸ì£¼ ìƒì‚°', icon: 'ğŸ„§', desc: "ì¹´ë“œ íŒë§¤ ì‹œ, í•„ìš” ì›ì†Œ 1ê°œë¥¼ ìƒëŒ€ë°© íë¸Œë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤. (ë¼ìš´ë“œë‹¹ 1íšŒ)" }
};
const diceRewards = [5, 10, 20, 40];
const techRewards = [10, 20, 30, 40];

// --- COORDINATE MAP FOR NEIGHBORS ---
const elementCoords = {};
const coordsToElement = {};
function buildCoordinateMap() {
    const mainGridMapping = {
        1: {r:1, c:1}, 2: {r:1, c:18}, 3: {r:2, c:1}, 4: {r:2, c:2},
        5: {r:2, c:13}, 6: {r:2, c:14}, 7: {r:2, c:15}, 8: {r:2, c:16}, 9: {r:2, c:17}, 10: {r:2, c:18},
        11: {r:3, c:1}, 12: {r:3, c:2}, 13: {r:3, c:13}, 14: {r:3, c:14}, 15: {r:3, c:15}, 16: {r:3, c:16}, 17: {r:3, c:17}, 18: {r:3, c:18},
    };
    for(const [num, pos] of Object.entries(mainGridMapping)) {
        elementCoords[num] = pos;
    }
    for(let i=19; i<=36; i++) elementCoords[i] = {r:4, c:i-18};
    for(let i=37; i<=54; i++) elementCoords[i] = {r:5, c:i-36};
    for(let i=55; i<=56; i++) elementCoords[i] = {r:6, c:i-54};
    for(let i=72; i<=86; i++) elementCoords[i] = {r:6, c:i-68};
    for(let i=87; i<=88; i++) elementCoords[i] = {r:7, c:i-86};
    for(let i=104; i<=118; i++) elementCoords[i] = {r:7, c:i-100};
    for(let i=57; i<=71; i++) elementCoords[i] = {r:8, c:i-54};
    for(let i=89; i<=103; i++) elementCoords[i] = {r:9, c:i-86};

    for(const [num, pos] of Object.entries(elementCoords)) {
        coordsToElement[`${pos.r},${pos.c}`] = parseInt(num);
    }
}


// DOM Elements
const app = {
    setupModal: document.getElementById('setup-modal'),
    startGameBtn: document.getElementById('start-game-btn'),
    playerCountSelector: document.getElementById('player-count-selector'),
    gameStatus: document.getElementById('game-status'),
    playersPanel: document.getElementById('players-panel'),
    tableContainer: document.getElementById('periodic-table-container'),
    controlsPanel: document.getElementById('controls-panel'),
    basicMarket: document.getElementById('basic-market'),
    advancedMarket: document.getElementById('advanced-market'),
    calcModal: document.getElementById('calculation-modal'),
    calcPlayerName: document.getElementById('calc-player-name'),
    diceRollResults: document.getElementById('dice-roll-results'),
    singleDiceOptions: document.getElementById('single-dice-options'),
    calcDice1: document.getElementById('calc-dice-1'),
    calcDice2: document.getElementById('calc-dice-2'),
    calcOp: document.getElementById('calc-op'),
    calcResult: document.getElementById('calc-result'),
    calcError: document.getElementById('calc-error'),
    confirmProductionBtn: document.getElementById('confirm-production-btn'),
    choiceModal: document.getElementById('choice-modal'),
    choiceTitle: document.getElementById('choice-title'),
    choiceOptions: document.getElementById('choice-options'),
    gameOverModal: document.getElementById('game-over-modal'),
    finalScores: document.getElementById('final-scores'),
    gameStats: document.getElementById('game-stats'),
    scoreboardPanel: document.getElementById('scoreboard-panel'),
    techTrackPanel: document.getElementById('tech-track-panel'),
    devPanel: document.getElementById('dev-panel'),
    toggleDevPanelBtn: document.getElementById('toggle-dev-panel'),
    returnToModalBtn: document.getElementById('return-to-modal-btn'),
};

// --- UTILITY FUNCTIONS ---
const shuffle = (array) => { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[array[i], array[j]] = [array[j], array[i]]; } return array; };
const rollDie = (type) => { if (type === 'd%') return Math.floor(Math.random() * 10) * 10; const sides = parseInt(type.slice(1)); return Math.floor(Math.random() * sides) + 1; };
const showMessage = (text, onOk) => {
    const modal = document.createElement('div');
    modal.className = 'modal-backdrop';
    modal.innerHTML = `
        <div class="modal-content text-center">
            <p class="text-lg mb-4 whitespace-pre-line">${text}</p>
            <button class="btn btn-primary">í™•ì¸</button>
        </div>
    `;
    modal.querySelector('button').onclick = () => {
        document.body.removeChild(modal);
        if (onOk) onOk();
    };
    document.body.appendChild(modal);
};

// --- DATA PARSING ---
const parseCards = () => {
    const lines = cardDataString.trim().split('\n');
    return lines.map((line, index) => {
        // Split by 2 or more spaces, but also use a lookahead to handle single spaces before numbers
        const parts = line.split(/\s{2,}|(?=\s\d+\s)/).filter(p => p && p.trim());
        const score = parseInt(parts[0]);
        if (isNaN(score)) return null;
        const name = parts[1];
        const type = parts[2] === 'ì¼ë°˜' ? 'basic' : 'advanced';
        const text = parts[3];
        const elementData = parts.slice(4);
        const elements = [];
        for (let i = 0; i < elementData.length; i += 3) {
            const num = parseInt(elementData[i]);
            if (!isNaN(num)) elements.push(num);
        }
        return { id: `card-${index}`, score, name, type, text, elements };
    }).filter(Boolean);
};
const allCards = parseCards();

// --- RENDER FUNCTIONS ---
function render() {
    if (!gameState.players) return;
    renderScoreboard();
    renderPlayersPanel();
    renderPeriodicTable();
    renderMarket();
    renderTechTrack();
    updateGameStatus();
    renderControls();
}

function renderScoreboard() {
    app.scoreboardPanel.innerHTML = '';
    const track = document.createElement('div');
    track.id = 'scoreboard-track';

    for (let i = 1; i <= 60; i++) {
        const cell = document.createElement('div');
        cell.className = 'score-cell';
        cell.textContent = i;
        cell.id = `score-cell-${i}`;
        if (diceRewards.includes(i)) cell.classList.add('dice-reward');
        if (techRewards.includes(i)) cell.classList.add('tech-reward');
        track.appendChild(cell);
    }
    app.scoreboardPanel.appendChild(track);

    const scorePositions = {};
    gameState.players.forEach(player => {
        const score = player.score > 60 ? 60 : player.score;
        if (!scorePositions[score]) {
            scorePositions[score] = 0;
        }
        const token = document.createElement('div');
        token.className = `player-token cube-${player.color}`;
        token.title = player.name;
        
        const targetCell = track.querySelector(`#score-cell-${score || 1}`);
        if (targetCell) {
            const offset = scorePositions[score] * 10;
            token.style.left = `${10 + offset}%`;
            token.style.top = `${10 + offset}%`;
            targetCell.appendChild(token);
            scorePositions[score]++;
        }
    });
}

function renderPlayersPanel() {
    app.playersPanel.innerHTML = '';
    gameState.players.forEach(player => {
        const playerDiv = document.createElement('div');
        playerDiv.className = `p-4 bg-bg-card border border-border-color rounded-lg shadow-md transition-all duration-300 ${player.id === gameState.currentPlayerId ? 'player-card active' : ''}`;
        
        const techHtml = player.tech.map(techId => {
            const tech = technologies[techId];
            return `<span class="tech-icon tech-${techId}" title="${tech.name}: ${tech.desc}">${tech.icon}</span>`;
        }).join('');

        const diceHtml = player.dice.map(d => `<span class="bg-slate-600 px-2 py-1 rounded text-xs font-mono">${diceNames[d]}</span>`).join(' ');
        
        let diceRollsHtml = '';
        if (gameState.phase === 'production' && player.diceResults.length > 0) {
            diceRollsHtml = `
                <div class="mt-2 p-2 bg-bg-dark rounded-md">
                    <p class="text-xs text-text-secondary mb-1">ì£¼ì‚¬ìœ„ ê²°ê³¼:</p>
                    <div class="flex flex-wrap gap-1">
                        ${player.diceResults.map(r => `<span class="font-bold text-accent-cyan">${r.value}</span>`).join(', ')}
                    </div>
                </div>
            `;
        }

        playerDiv.innerHTML = `
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <span class="w-5 h-5 rounded-full cube-${player.color}"></span>
                    ${player.name}
                </h3>
            </div>
            <div class="space-y-3 text-sm">
                <p class="flex items-center gap-2"><strong>ì£¼ì‚¬ìœ„:</strong> <span class="flex flex-wrap gap-1">${diceHtml}</span></p>
                <p class="flex items-start gap-2"><strong>ê¸°ìˆ :</strong> <span class="flex flex-wrap gap-1">${techHtml || 'ì—†ìŒ'}</span></p>
                <p><strong>ìƒì‚° íë¸Œ:</strong> <span class="font-bold text-accent-cyan">${player.cubesOnBoard.length} / 6</span></p>
            </div>
            ${diceRollsHtml}
        `;
        app.playersPanel.appendChild(playerDiv);
    });
}

function renderPeriodicTable() {
    const container = app.tableContainer;
    container.innerHTML = ''; // Clear previous content

    const mainGrid = document.createElement('div');
    mainGrid.className = 'periodic-table-grid';
    
    const lanthanideGrid = document.createElement('div');
    lanthanideGrid.className = 'periodic-table-grid mt-4';
    
    const actinideGrid = document.createElement('div');
    actinideGrid.className = 'periodic-table-grid mt-1';

    const productionTarget = gameState.productionTarget;

    for (let i = 1; i <= 118; i++) {
        const element = periodicTableData[i];
        if (!element) continue;

        const cell = document.createElement('div');
        cell.className = `element-cell group-${element.group}`;
        cell.dataset.atomicNumber = i;

        if (productionTarget === i) cell.classList.add('producible');
        if (gameState.explosionChoices?.includes(i) || gameState.slideChoices?.includes(i)) cell.classList.add('explosion-choice');
        if (gameState.slideSource === i) cell.classList.add('slide-source');

        const playersOnElement = gameState.players.filter(p => p.cubesOnBoard.includes(i));
        const cubeHtml = playersOnElement.map(p => `<div class="cube cube-${p.color}" title="${p.name}"></div>`).join('');

        cell.innerHTML = `
            <div class="element-number">${element.number}</div>
            <div class="element-symbol">${element.symbol}</div>
            <div class="element-name">${element.name}</div>
            <div class="cube-container">${cubeHtml}</div>
        `;

        if (element.number >= 57 && element.number <= 71) {
            cell.style.gridColumn = `${element.number - 57 + 3} / span 1`;
            lanthanideGrid.appendChild(cell);
        } else if (element.number >= 89 && element.number <= 103) {
            cell.style.gridColumn = `${element.number - 89 + 3} / span 1`;
            actinideGrid.appendChild(cell);
        } else {
            if (element.number === 1) cell.style.gridColumn = '1 / span 1';
            else if (element.number === 2) cell.style.gridColumn = '18 / span 1';
            else if (element.number >= 3 && element.number <= 4) cell.style.gridColumn = `${element.number - 2} / span 1`;
            else if (element.number >= 5 && element.number <= 10) cell.style.gridColumn = `${element.number + 8} / span 1`;
            else if (element.number >= 11 && element.number <= 12) cell.style.gridColumn = `${element.number - 10} / span 1`;
            else if (element.number >= 13 && element.number <= 18) cell.style.gridColumn = `${element.number} / span 1`;
            else if (element.number >= 19 && element.number <= 36) cell.style.gridColumn = `${element.number - 18} / span 1`;
            else if (element.number >= 37 && element.number <= 54) cell.style.gridColumn = `${element.number - 36} / span 1`;
            else if (element.number >= 55 && element.number <= 56) cell.style.gridColumn = `${element.number - 54} / span 1`;
            else if (element.number >= 72 && element.number <= 86) cell.style.gridColumn = `${element.number - 68} / span 1`;
            else if (element.number >= 87 && element.number <= 88) cell.style.gridColumn = `${element.number - 86} / span 1`;
            else if (element.number >= 104 && element.number <= 118) cell.style.gridColumn = `${element.number - 100} / span 1`;
            mainGrid.appendChild(cell);
        }
    }
    container.appendChild(mainGrid);
    container.appendChild(lanthanideGrid);
    container.appendChild(actinideGrid);
}

function renderMarket() {
    function renderDeck(market, deck, deckElem, deckType) {
        deckElem.innerHTML = '';
        market.forEach((card) => {
            deckElem.appendChild(createCardDOM(card, deckType, false));
        });
        
        const nextCard = deck[0];
        if (nextCard) {
            const previewWrapper = document.createElement('div');
            previewWrapper.className = "mt-3";
            previewWrapper.innerHTML = `<p class="text-xs text-center text-text-secondary mb-1">ë‹¤ìŒ ì¹´ë“œ</p>`;
            previewWrapper.appendChild(createCardDOM(nextCard, deckType, true));
            deckElem.appendChild(previewWrapper);
        }
    }

    renderDeck(gameState.market.basic, gameState.decks.basic, app.basicMarket, 'basic');
    renderDeck(gameState.market.advanced, gameState.decks.advanced, app.advancedMarket, 'advanced');
    
    document.querySelectorAll('.sell-btn').forEach(btn => btn.addEventListener('click', handleSellCard));
}

function createCardDOM(card, cardType, isPreview) {
    const cardDiv = document.createElement('div');
    cardDiv.className = `bg-bg-card border border-border-color p-3 rounded-lg shadow-md flex flex-col ${isPreview ? 'opacity-50' : ''}`;
    
    const elementsHtml = card.elements.map(num => {
        const el = periodicTableData[num];
        const ownersHtml = gameState.players
            .filter(p => p.cubesOnBoard.includes(el.number))
            .map(p => `<div class="w-2 h-2 rounded-full cube-${p.color}" title="${p.name}"></div>`)
            .join('');

        return `<div class="flex items-center gap-1 bg-slate-700 px-2 py-1 rounded-full text-xs">
                   <div class="w-3 h-3 rounded-full" style="background-color: var(--group-${el.group})"></div>
                   <span class="font-bold">${el.symbol}</span>
                   <span class="text-text-secondary">(${el.number})</span>
                   <div class="flex ml-1 gap-px">${ownersHtml}</div>
                </div>`;
    }).join('');
    
    const canSell = canPlayerSellCard(gameState.players.find(p => p.id === gameState.currentPlayerId), card);

    cardDiv.innerHTML = `
        <div class="flex-grow">
            <div class="flex justify-between items-start">
                <h4 class="font-bold text-base ${card.type === 'basic' ? 'text-accent-amber' : 'text-fuchsia-400'}">${card.name}</h4>
                <span class="text-lg font-bold text-white">${card.score}ì </span>
            </div>
            <p class="text-xs text-text-secondary mt-1 mb-2">${card.text}</p>
            <div class="flex flex-wrap gap-2 items-center"><strong>í•„ìš”:</strong> ${elementsHtml}</div>
        </div>
        <div class="text-right mt-3">
            <button class="btn text-sm sell-btn ${canSell && !isPreview ? 'btn-primary' : 'btn-secondary'}" 
                    data-card-id="${card.id}" data-card-type="${cardType}" ${(!canSell || isPreview || gameState.phase !== 'sales') ? 'disabled' : ''}>
                íŒë§¤
            </button>
        </div>
    `;
    return cardDiv;
}

function renderTechTrack() {
    app.techTrackPanel.innerHTML = '<h3 class="text-xl font-bold text-center mb-3 text-accent-cyan">ğŸ’¡ ê¸°ìˆ  íŠ¸ë™</h3>';
    const grid = document.createElement('div');
    grid.className = 'grid grid-cols-2 gap-3';
    
    Object.values(technologies).forEach(tech => {
        const techCard = document.createElement('div');
        techCard.className = 'bg-bg-dark p-2 rounded';
        
        const acquiredByHtml = gameState.players
            .filter(p => p.tech.includes(tech.id))
            .map(p => `<div class="w-4 h-4 rounded-full cube-${p.color}" title="${p.name}"></div>`)
            .join('');

        techCard.innerHTML = `
            <div class="flex items-center gap-2">
                <span class="tech-icon tech-${tech.id}">${tech.icon}</span>
                <span class="font-bold">${tech.name}</span>
            </div>
            <p class="text-xs text-text-secondary mt-1">${tech.desc}</p>
            <div class="flex items-center gap-1 mt-2 h-4">${acquiredByHtml}</div>
        `;
        grid.appendChild(techCard);
    });
    app.techTrackPanel.appendChild(grid);
}

function renderControls() {
    app.controlsPanel.innerHTML = '';
    const player = gameState.players.find(p => p.id === gameState.currentPlayerId);
    
    if (gameState.phase === 'production') {
        const text = document.createElement('p');
        text.className = 'text-text-secondary mb-2';
        text.textContent = `ìƒì‚° ë‹¨ê³„: ${player.name} ë‹˜ì´ ìƒì‚°í•  ì›ì†Œë¥¼ ì„ íƒí•˜ì„¸ìš”.`;
        app.controlsPanel.appendChild(text);

        const btn = document.createElement('button');
        btn.className = 'btn btn-primary';
        btn.textContent = 'ì›ì†Œ ì„ íƒí•˜ê¸°';
        btn.onclick = () => openCalculationModal(player);
        app.controlsPanel.appendChild(btn);
        
    } else if (gameState.phase === 'sales') {
        const text = document.createElement('p');
        text.className = 'text-text-secondary mb-2';
        text.textContent = `íŒë§¤ ë‹¨ê³„: ${player.name} ë‹˜ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤.`;
        app.controlsPanel.appendChild(text);

        const btn = document.createElement('button');
        btn.className = 'btn btn-secondary';
        btn.textContent = 'íŒë§¤í•˜ì§€ ì•Šê³  í„´ ì¢…ë£Œ';
        btn.onclick = handleEndTurn;
        app.controlsPanel.appendChild(btn);
    } else if (gameState.phase === 'AWAITING_SLIDE') {
        const text = document.createElement('p');
        text.className = 'text-text-secondary mb-2';
        text.textContent = `ìŠ¬ë¼ì´ë“œ: ì´ë™í•  íë¸Œë¥¼ ì„ íƒí•˜ì„¸ìš”.`;
        app.controlsPanel.appendChild(text);
        const btn = document.createElement('button');
        btn.className = 'btn btn-secondary';
        btn.textContent = 'ìŠ¬ë¼ì´ë“œ ê±´ë„ˆë›°ê¸°';
        btn.onclick = () => {
            gameState.phase = 'production';
            advanceProductionTurn();
        };
        app.controlsPanel.appendChild(btn);
    }
}

function updateGameStatus() {
    if (!gameState.phase) return;
    const player = gameState.players.find(p => p.id === gameState.currentPlayerId);
    let statusText = `ë¼ìš´ë“œ ${gameState.round} | `;
    if (gameState.phase === 'production') {
        statusText += `ìƒì‚° ë‹¨ê³„ - ${player.name} ì„ íƒ ì¤‘`;
    } else if (gameState.phase === 'sales') {
        statusText += `íŒë§¤ ë‹¨ê³„ - ${player.name}ì˜ í„´`;
    } else if (gameState.phase === 'AWAITING_SLIDE') {
        statusText += `ìŠ¬ë¼ì´ë“œ ë‹¨ê³„ - ${player.name} íë¸Œ ì´ë™ ì¤‘`;
    }
    app.gameStatus.textContent = statusText;
}


// --- GAME LOGIC FUNCTIONS ---
function initGame() {
    const playerCount = gameState.playerCount;
    if (!playerCount) {
        showMessage('í”Œë ˆì´ì–´ ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    app.setupModal.classList.add('hidden');

    const basicCards = allCards.filter(c => c.type === 'basic');
    const advancedCards = allCards.filter(c => c.type === 'advanced');
    const basicStarters = basicCards.filter(c => c.elements.length === 1);
    const basicOthers = basicCards.filter(c => c.elements.length !== 1);
    const advancedStarters = advancedCards.filter(c => c.elements.length === 1);
    const advancedOthers = advancedCards.filter(c => c.elements.length !== 1);

    gameState = {
        ...gameState,
        players: [],
        log: [],
        decks: {
            basic: [...basicStarters, ...shuffle(basicOthers)],
            advanced: [...advancedStarters, ...shuffle(advancedOthers)]
        },
        market: { basic: [], advanced: [] },
        round: 1,
        phase: 'production',
        currentPlayerId: 0,
        firstPlayerId: 0,
        gameOver: false,
        productionTarget: null,
        explosionChoices: null,
        slideSource: null,
        slideChoices: null,
        hiddenModal: null,
    };

    for (let i = 0; i < playerCount; i++) {
        gameState.players.push({
            id: i, name: `í”Œë ˆì´ì–´ ${i + 1}`, color: playerColors[i],
            score: 0, dice: ['d20', 'd6', 'd4'], tech: [],
            cubesOnBoard: [], soldCards: [],
            diceResults: [], usedOutsource: false,
            scoreMilestones: { dice: [], tech: [] }
        });
    }

    for (let i = 0; i < 4; i++) {
        if (gameState.decks.basic.length > 0) gameState.market.basic.push(gameState.decks.basic.shift());
        if (gameState.decks.advanced.length > 0) gameState.market.advanced.push(gameState.decks.advanced.shift());
    }

    startProductionPhase();
}

function logEvent(logData) {
    gameState.log.push({ ...logData, round: gameState.round });
}

function startProductionPhase() {
    gameState.phase = 'production';
    gameState.productionTarget = null;
    gameState.currentPlayerId = gameState.firstPlayerId;
    
    gameState.players.forEach(p => {
        p.diceResults = p.dice.map(d => ({ type: d, value: rollDie(d) }));
        p.usedOutsource = false;
    });
    showMessage("ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¸ìŠµë‹ˆë‹¤! ì„  í”Œë ˆì´ì–´ë¶€í„° ì›ì†Œë¥¼ ìƒì‚°í•˜ì„¸ìš”.", render);
}

function openCalculationModal(player) {
    app.calcPlayerName.textContent = `${player.name}ì˜ ìƒì‚°`;
    app.diceRollResults.innerHTML = player.diceResults.map(r => `<span class="bg-bg-dark border border-border-color p-2 rounded font-bold">${diceNames[r.type]}: ${r.value}</span>`).join('');
    
    app.singleDiceOptions.innerHTML = '';
    player.diceResults.forEach(r => {
        const btn = document.createElement('button');
        btn.className = 'btn btn-secondary';
        btn.textContent = r.value;
        btn.onclick = () => selectProductionNumber(r.value);
        app.singleDiceOptions.appendChild(btn);
    });

    const diceOptionsHtml = player.diceResults.map((r, i) => `<option value="${i}">${r.value} (${diceNames[r.type]})</option>`).join('');
    app.calcDice1.innerHTML = diceOptionsHtml;
    app.calcDice2.innerHTML = diceOptionsHtml;

    const ops = ['+', 'âˆ’'];
    if (player.tech.includes('multiply')) ops.push('Ã—', 'Ã·');
    if (player.tech.includes('concat')) ops.push('â§–');
    app.calcOp.innerHTML = ops.map(op => `<option value="${op}">${op}</option>`).join('');

    [app.calcDice1, app.calcDice2, app.calcOp].forEach(el => { el.onchange = updateCalcResult; });

    app.confirmProductionBtn.onclick = () => {
        const finalValue = parseInt(app.calcResult.textContent);
        if (isNaN(finalValue) || finalValue < 1 || finalValue > 118) {
            showMessage("ìœ íš¨í•œ ì›ìë²ˆí˜¸(1-118)ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.");
            return;
        }
        app.calcModal.classList.add('hidden');
        handlePlaceCube(player, finalValue);
    };
    
    updateCalcResult();
    app.calcModal.classList.remove('hidden');
}

function openChoiceModal({ title, options, onChoose, isDice = false }) {
    app.choiceTitle.textContent = title;
    app.choiceOptions.innerHTML = '';
    options.forEach(option => {
        const button = document.createElement('button');
        button.className = 'btn btn-secondary';
        button.textContent = isDice ? diceNames[option.text] : option.text;
        button.onclick = () => {
            app.choiceModal.classList.add('hidden');
            onChoose(option.value);
        };
        app.choiceOptions.appendChild(button);
    });
    app.choiceModal.classList.remove('hidden');
}


function selectProductionNumber(num) {
    app.calcResult.textContent = num;
    gameState.productionTarget = num;
    app.confirmProductionBtn.disabled = false;
    renderPeriodicTable();
}

function updateCalcResult() {
    const idx1 = parseInt(app.calcDice1.value);
    const idx2 = parseInt(app.calcDice2.value);
    const op = app.calcOp.value;
    
    const player = gameState.players.find(p => p.id === gameState.currentPlayerId);
    if (!player) return;
    
    app.calcError.textContent = '';
    if (idx1 === idx2) {
        app.calcError.textContent = 'ì¤‘ë³µëœ ì£¼ì‚¬ìœ„ë¥¼ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
        app.confirmProductionBtn.disabled = true;
        gameState.productionTarget = null;
        renderPeriodicTable();
        return;
    }

    const val1 = player.diceResults[idx1].value;
    const val2 = player.diceResults[idx2].value;

    let result = NaN;
    switch (op) {
        case '+': result = val1 + val2; break;
        case 'âˆ’': result = Math.abs(val1 - val2); break;
        case 'Ã—': result = val1 * val2; break;
        case 'Ã·': result = Math.floor(val1 / val2); break;
        case 'â§–': result = parseInt(`${val1}${val2}`); break;
    }
    
    if (isNaN(result) || result < 1 || result > 118) {
        app.calcResult.textContent = 'X';
        app.confirmProductionBtn.disabled = true;
        gameState.productionTarget = null;
    } else {
        app.calcResult.textContent = result;
        app.confirmProductionBtn.disabled = false;
        gameState.productionTarget = result;
    }
    renderPeriodicTable();
}

function handlePlaceCube(player, atomicNumber) {
    const isDuplicate = player.cubesOnBoard.includes(atomicNumber);

    if (isDuplicate) {
        showMessage("ì›ì†Œ í­ë°œ!", () => {
            const neighbors = getNeighbors(atomicNumber);
            const emptyNeighbors = neighbors.filter(n => !player.cubesOnBoard.includes(n));
            if (emptyNeighbors.length > 0) {
                gameState.explosionChoices = emptyNeighbors;
                renderPeriodicTable();
                showMessage("ì¸ì ‘í•œ ë¹ˆ ì¹¸ ì¤‘ í•˜ë‚˜ë¥¼ í´ë¦­í•˜ì—¬ íë¸Œë¥¼ ë†“ìœ¼ì„¸ìš”.");
            } else {
                showMessage("ì¸ì ‘í•œ ë¹ˆ ì¹¸ì´ ì—†ì–´ íë¸Œë¥¼ ë†“ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", () => postPlacementAction(player));
            }
        });
    } else {
        if (player.cubesOnBoard.length >= 6) {
            openChoiceModal({
                title: 'íë¸Œ êµì²´: ì–´ëŠ íë¸Œë¥¼ ì˜®ê¸°ì‹œê² ìŠµë‹ˆê¹Œ?',
                options: player.cubesOnBoard.map(n => ({ text: `${periodicTableData[n].symbol} (${periodicTableData[n].name})`, value: n })),
                onChoose: (toRemove) => {
                    player.cubesOnBoard = player.cubesOnBoard.filter(n => n !== toRemove);
                    player.cubesOnBoard.push(atomicNumber);
                    logEvent({type: 'PRODUCE', player: player.name, element: periodicTableData[atomicNumber].name });
                    postPlacementAction(player);
                }
            });
        } else {
            player.cubesOnBoard.push(atomicNumber);
            logEvent({type: 'PRODUCE', player: player.name, element: periodicTableData[atomicNumber].name });
            postPlacementAction(player);
        }
    }
}

function postPlacementAction(player) {
    gameState.productionTarget = null;
    gameState.explosionChoices = null;
    render();
    if (player.tech.includes('slide')) {
        gameState.phase = 'AWAITING_SLIDE';
        showMessage(`${player.name}ë‹˜ì€ ìŠ¬ë¼ì´ë“œ ê¸°ìˆ ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë™í•  íë¸Œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ê±´ë„ˆë›°ì„¸ìš”.`);
        render();
    } else {
        advanceProductionTurn();
    }
}

function advanceProductionTurn() {
    gameState.productionTarget = null;
    gameState.explosionChoices = null;
    gameState.slideSource = null;
    gameState.slideChoices = null;
    gameState.phase = 'production';

    const nextPlayerId = (gameState.currentPlayerId + 1) % gameState.players.length;
    gameState.currentPlayerId = nextPlayerId;

    if (gameState.currentPlayerId === gameState.firstPlayerId) {
        startSalesPhase();
    } else {
        render();
    }
}

function getNeighbors(atomicNumber) {
    if (!elementCoords[atomicNumber]) return [];
    const { r, c } = elementCoords[atomicNumber];
    const potentialNeighbors = [
        coordsToElement[`${r},${c - 1}`], // left
        coordsToElement[`${r},${c + 1}`], // right
        coordsToElement[`${r - 1},${c}`], // up
        coordsToElement[`${r + 1},${c}`], // down
    ];
    // Special adjacency rules
    if (atomicNumber === 1) potentialNeighbors.push(2);
    if (atomicNumber === 2) potentialNeighbors.push(1);
    if (atomicNumber === 4) potentialNeighbors.push(5);
    if (atomicNumber === 5) potentialNeighbors.push(4);
    if (atomicNumber === 12) potentialNeighbors.push(13);
    if (atomicNumber === 13) potentialNeighbors.push(12);
    
    return [...new Set(potentialNeighbors.filter(n => n !== undefined))];
}

function startSalesPhase() {
    gameState.phase = 'sales';
    gameState.currentPlayerId = gameState.firstPlayerId;
    showMessage("ìƒì‚° ë‹¨ê³„ê°€ ëë‚¬ìŠµë‹ˆë‹¤. ì´ì œ í™”í•©ë¬¼ì„ íŒë§¤í•˜ì„¸ìš”.", render);
}

function canPlayerSellCard(player, card) {
    if (!player || !card) return false;
    
    let ownedElements = 0;
    card.elements.forEach(elNum => {
        if (player.cubesOnBoard.includes(elNum)) {
            ownedElements++;
        }
    });

    if (ownedElements === card.elements.length) return true;

    if (player.tech.includes('outsource') && !player.usedOutsource) {
        let needed = [];
        card.elements.forEach(elNum => {
            if (!player.cubesOnBoard.includes(elNum)) needed.push(elNum);
        });
        if (needed.length === 1 && gameState.players.some(p => p.id !== player.id && p.cubesOnBoard.includes(needed[0]))) {
            return true;
        }
    }
    return false;
}

async function handleSellCard(event) {
    const cardId = event.target.dataset.cardId;
    const cardType = event.target.dataset.cardType;
    const player = gameState.players.find(p => p.id === gameState.currentPlayerId);
    
    const market = gameState.market[cardType];
    const cardIndex = market.findIndex(c => c.id === cardId);
    if (cardIndex === -1) return;
    const card = market[cardIndex];

    if (canPlayerSellCard(player, card)) {
        const ownedCount = card.elements.filter(el => player.cubesOnBoard.includes(el)).length;
        if (ownedCount < card.elements.length) {
            player.usedOutsource = true;
        }

        const oldScore = player.score;
        player.score += card.score;
        player.soldCards.push(card);
        logEvent({type: 'SELL_CARD', player: player.name, cardName: card.name, score: card.score });


        market.splice(cardIndex, 1);
        const deck = gameState.decks[cardType];
        if (deck.length > 0) market.push(deck.shift());

        await showMessageAndWait(`${player.name}ë‹˜ì´ '${card.name}' ì¹´ë“œë¥¼ íŒë§¤í•˜ì—¬ ${card.score}ì ì„ íšë“í–ˆìŠµë‹ˆë‹¤! (ì´ ${player.score}ì )`);
        
        await checkScoreMilestones(player, oldScore);
        
        if (gameState.gameOver) return;
        handleEndTurn();
    }
}

async function checkScoreMilestones(player, oldScore) {
    for (const score of diceRewards) {
        if (oldScore < score && player.score >= score && !player.scoreMilestones.dice.includes(score)) {
            player.scoreMilestones.dice.push(score);
            if (player.dice.length < 7) {
                const availableDice = allDiceTypes.filter(d => !player.dice.includes(d));
                if (availableDice.length > 0) {
                    const chosenDie = await new Promise(resolve => {
                        openChoiceModal({
                            title: `ì£¼ì‚¬ìœ„ íšë“! ì›í•˜ëŠ” ì£¼ì‚¬ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”.`,
                            options: availableDice.map(d => ({ text: d, value: d })),
                            isDice: true,
                            onChoose: resolve
                        });
                    });
                    player.dice.push(chosenDie);
                    logEvent({type: 'GET_DICE', player: player.name, die: diceNames[chosenDie] });
                    await showMessageAndWait(`${player.name}ë‹˜ì´ ${score}ì  ë³´ìƒìœ¼ë¡œ ${diceNames[chosenDie]} ì£¼ì‚¬ìœ„ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`);
                }
            }
        }
    }

    for (const score of techRewards) {
        if (oldScore < score && player.score >= score && !player.scoreMilestones.tech.includes(score)) {
            player.scoreMilestones.tech.push(score);
            const availableTech = Object.values(technologies).filter(t => !player.tech.includes(t.id));
            if (availableTech.length > 0) {
                 const chosenTechId = await new Promise(resolve => {
                        openChoiceModal({
                            title: `ê¸°ìˆ  íšë“! ì›í•˜ëŠ” ê¸°ìˆ ì„ ì„ íƒí•˜ì„¸ìš”.`,
                            options: availableTech.map(t => ({ text: t.name, value: t.id })),
                            onChoose: resolve
                        });
                    });
                player.tech.push(chosenTechId);
                logEvent({type: 'GET_TECH', player: player.name, tech: technologies[chosenTechId].name });
                await showMessageAndWait(`${player.name}ë‹˜ì´ ${score}ì  ë³´ìƒìœ¼ë¡œ '${technologies[chosenTechId].name}' ê¸°ìˆ ì„ íšë“í–ˆìŠµë‹ˆë‹¤!`);
            }
        }
    }

    if (player.score >= 50 && !gameState.isEnding) {
        gameState.isEnding = true;
        await showMessageAndWait(`ì´ë²ˆ ë¼ìš´ë“œê°€ ë§ˆì§€ë§‰ ë¼ìš´ë“œì…ë‹ˆë‹¤! ${player.name}ë‹˜ì´ 50ì ì„ ëŒíŒŒí–ˆìŠµë‹ˆë‹¤!`);
    }
}

function showMessageAndWait(text) {
    return new Promise(resolve => showMessage(text, resolve));
}

function handleEndTurn() {
    if (gameState.gameOver) return;

    let nextPlayerId = (gameState.currentPlayerId + 1) % gameState.players.length;
    gameState.currentPlayerId = nextPlayerId;

    if (gameState.currentPlayerId === gameState.firstPlayerId) {
        if (gameState.isEnding) {
            endGame();
        } else {
            gameState.round++;
            gameState.firstPlayerId = (gameState.firstPlayerId + 1) % gameState.players.length;
            startProductionPhase();
        }
    } else {
        render();
    }
}

function endGame() {
    gameState.gameOver = true;

    const relevantGroups = new Set(['alkali-metal', 'transition-metal', 'metalloid', 'halogen', 'alkaline-earth-metal', 'post-transition-metal', 'other-nonmetal', 'noble-gas']);
    gameState.players.forEach(player => {
        const collectedGroups = new Set();
        player.soldCards.forEach(card => {
            card.elements.forEach(elNum => {
                const group = periodicTableData[elNum]?.group;
                if (relevantGroups.has(group)) {
                    collectedGroups.add(group);
                }
            });
        });
        player.elementColorCount = collectedGroups.size;
        player.finalScore = player.score + player.elementColorCount;
    });

    gameState.players.sort((a, b) => {
        if (b.finalScore !== a.finalScore) return b.finalScore - a.finalScore;
        const advancedCountB = b.soldCards.filter(c => c.type === 'advanced').length;
        const advancedCountA = a.soldCards.filter(c => c.type === 'advanced').length;
        if (advancedCountB !== advancedCountA) return advancedCountB - advancedCountA;
        if (b.elementColorCount !== a.elementColorCount) return b.elementColorCount - a.elementColorCount;
        return b.dice.length - a.dice.length;
    });

    app.finalScores.innerHTML = gameState.players.map((p, index) => `
        <div class="p-3 rounded ${index === 0 ? 'bg-accent-amber text-bg-dark' : 'bg-bg-dark text-text-primary'}">
            <p class="text-xl font-bold">${index + 1}ìœ„: ${p.name} - ${p.finalScore}ì </p>
            <p class="text-sm">ì¹´ë“œ ì ìˆ˜ ${p.score}ì  + ì›ì†Œ ì¢…ë¥˜ ë³´ë„ˆìŠ¤ ${p.elementColorCount}ì </p>
        </div>
    `).join('');

    displayGameStats();
    app.gameOverModal.classList.remove('hidden');
}

function displayGameStats() {
    let statsHtml = `<h3 class="text-lg font-bold mb-2 text-accent-cyan">ê²Œì„ í†µê³„</h3>`;
    const productionCounts = gameState.log.filter(l => l.type === 'PRODUCE').reduce((acc, l) => {
        acc[l.element] = (acc[l.element] || 0) + 1;
        return acc;
    }, {});
    const mostProduced = Object.entries(productionCounts).sort((a, b) => b[1] - a[1])[0];
    if (mostProduced) {
        statsHtml += `<p><strong>ê°€ì¥ ë§ì´ ìƒì‚°ëœ ì›ì†Œ:</strong> ${mostProduced[0]} (${mostProduced[1]}íšŒ)</p>`;
    }
    
    const sales = gameState.log.filter(l => l.type === 'SELL_CARD');
    const bestSale = sales.sort((a, b) => b.score - a.score)[0];
    if(bestSale) {
        statsHtml += `<p><strong>ìµœê³ ì  ì¹´ë“œ íŒë§¤:</strong> ${bestSale.player} (${bestSale.cardName}, ${bestSale.score}ì )</p>`;
    }
    app.gameStats.innerHTML = statsHtml;
}


// --- INITIALIZATION ---
function setupInitialUI() {
    buildCoordinateMap();
    for (let i = 2; i <= 6; i++) {
        const button = document.createElement('button');
        button.className = 'btn btn-secondary';
        button.textContent = `${i}ëª…`;
        button.dataset.count = i;
        app.playerCountSelector.appendChild(button);
    }

    app.playerCountSelector.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            const count = e.target.dataset.count;
            gameState.playerCount = parseInt(count);
            
            app.playerCountSelector.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('btn-primary', 'bg-accent-cyan');
                btn.classList.add('btn-secondary');
            });
            e.target.classList.remove('btn-secondary');
            e.target.classList.add('btn-primary', 'bg-accent-cyan');

            app.startGameBtn.disabled = false;
        }
    });

    app.startGameBtn.addEventListener('click', initGame);

    // Dev Tools
    app.toggleDevPanelBtn.addEventListener('click', () => {
        app.devPanel.classList.toggle('hidden');
    });

    document.getElementById('dev-add-score').addEventListener('click', () => {
        const player = gameState.players.find(p => p.id === gameState.currentPlayerId);
        const scoreInput = document.getElementById('dev-score-num');
        const scoreToAdd = parseInt(scoreInput.value) || 0;
        if (player) {
            const oldScore = player.score;
            player.score += scoreToAdd;
            checkScoreMilestones(player, oldScore);
            render();
        }
    });

    document.getElementById('dev-add-die').addEventListener('click', () => {
        const player = gameState.players.find(p => p.id === gameState.currentPlayerId);
        if (player && player.dice.length < 7) {
            const availableDice = allDiceTypes.filter(d => !player.dice.includes(d));
            if (availableDice.length > 0) {
                player.dice.push(availableDice[0]);
                render();
            }
        }
    });

    document.getElementById('dev-add-tech').addEventListener('click', () => {
        const player = gameState.players.find(p => p.id === gameState.currentPlayerId);
        if (player) {
            const availableTech = Object.values(technologies).filter(t => !player.tech.includes(t.id));
            if (availableTech.length > 0) {
                player.tech.push(availableTech[0].id);
                render();
            }
        }
    });
    
    document.getElementById('dev-add-cube').addEventListener('click', () => {
        const player = gameState.players.find(p => p.id === gameState.currentPlayerId);
        const numInput = document.getElementById('dev-element-num');
        const num = parseInt(numInput.value);
        if (player && num > 0 && num <= 118) {
            if (!player.cubesOnBoard.includes(num)) {
                if (player.cubesOnBoard.length >= 6) {
                    player.cubesOnBoard.shift(); 
                }
                player.cubesOnBoard.push(num);
                numInput.value = ''; 
                render();
            }
        }
    });

    app.tableContainer.addEventListener('click', (e) => {
        const cell = e.target.closest('.element-cell');
        if (!cell) return;
        const num = parseInt(cell.dataset.atomicNumber);
        const player = gameState.players.find(p => p.id === gameState.currentPlayerId);

        if (gameState.explosionChoices?.includes(num)) {
            if (player.cubesOnBoard.length >= 6) {
                openChoiceModal({
                    title: 'íë¸Œ êµì²´: ì–´ëŠ íë¸Œë¥¼ ì˜®ê¸°ì‹œê² ìŠµë‹ˆê¹Œ?',
                    options: player.cubesOnBoard.map(n => ({ text: `${periodicTableData[n].symbol} (${periodicTableData[n].name})`, value: n })),
                    onChoose: (toRemove) => {
                        player.cubesOnBoard = player.cubesOnBoard.filter(n => n !== toRemove);
                        player.cubesOnBoard.push(num);
                        postPlacementAction(player);
                    }
                });
            } else {
                player.cubesOnBoard.push(num);
                postPlacementAction(player);
            }
        } else if (gameState.phase === 'AWAITING_SLIDE') {
            if (gameState.slideSource === null && player.cubesOnBoard.includes(num)) {
                gameState.slideSource = num;
                const neighbors = getNeighbors(num);
                gameState.slideChoices = neighbors.filter(n => !player.cubesOnBoard.includes(n));
                render();
            } else if (gameState.slideChoices?.includes(num)) {
                player.cubesOnBoard = player.cubesOnBoard.filter(n => n !== gameState.slideSource);
                player.cubesOnBoard.push(num);
                gameState.phase = 'production';
                advanceProductionTurn();
            }
        }
    });
    
    function hideCurrentModal(modalId) {
        gameState.hiddenModalId = modalId;
        document.getElementById(modalId).classList.add('hidden');
        app.returnToModalBtn.classList.remove('hidden');
    }
    
    function showHiddenModal() {
        if(gameState.hiddenModalId) {
            document.getElementById(gameState.hiddenModalId).classList.remove('hidden');
            app.returnToModalBtn.classList.add('hidden');
            gameState.hiddenModalId = null;
        }
    }
    
    document.getElementById('view-market-calc-btn').addEventListener('click', () => hideCurrentModal('calculation-modal'));
    document.getElementById('view-market-choice-btn').addEventListener('click', () => hideCurrentModal('choice-modal'));
    app.returnToModalBtn.addEventListener('click', showHiddenModal);
}

window.onload = () => {
    setupInitialUI();
    app.setupModal.classList.remove('hidden');
};
</script>

</body>
</html>
